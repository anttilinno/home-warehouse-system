# Requirements Archive: v1.8 Docker Deployment

**Archived:** 2026-02-14
**Status:** SHIPPED

---

## v1.8 Requirements

### Compose Profiles

- [x] **COMP-01**: Dev profile runs only Postgres + Redis with exposed ports for host development
- [x] **COMP-02**: Prod profile runs full stack (Postgres, Redis, backend, worker, scheduler, frontend, Angie)
- [x] **COMP-03**: Prod Postgres uses separate container and volume from dev with no exposed ports
- [x] **COMP-04**: Docspell services moved to prod profile (not always-on)
- [x] **COMP-05**: Migration runner executes before app services start in prod

### Container Images

- [x] **IMG-01**: Backend image uses multi-stage build (Go builder + Alpine runtime with libwebp)
- [x] **IMG-02**: Frontend image uses multi-stage build (bun builder + Node slim runner with standalone output)
- [x] **IMG-03**: Worker has its own Dockerfile with only needed dependencies (no libwebp)
- [x] **IMG-04**: Scheduler has its own Dockerfile with only needed dependencies

### Reverse Proxy

- [x] **PROXY-01**: Angie routes API requests to backend and all other requests to frontend
- [x] **PROXY-02**: SSE connections proxied with buffering disabled and long timeouts
- [x] **PROXY-03**: HTTPS with self-signed certs (cert generation script provided)
- [x] **PROXY-04**: HTTP-to-HTTPS redirect

### Environment Configuration

- [x] **ENV-01**: Prod environment variables set for production (NODE_ENV=production, no debug flags)
- [x] **ENV-02**: Dev credentials not exposed in production containers
- [x] **ENV-03**: Photo storage uses named Docker volume in prod

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| COMP-01 | Phase 40 | Complete |
| COMP-02 | Phase 40 | Complete |
| COMP-03 | Phase 40 | Complete |
| COMP-04 | Phase 40 | Complete |
| COMP-05 | Phase 40 | Complete |
| ENV-01 | Phase 40 | Complete |
| ENV-02 | Phase 40 | Complete |
| ENV-03 | Phase 40 | Complete |
| IMG-01 | Phase 41 | Complete |
| IMG-02 | Phase 41 | Complete |
| IMG-03 | Phase 41 | Complete |
| IMG-04 | Phase 41 | Complete |
| PROXY-01 | Phase 42 | Complete |
| PROXY-02 | Phase 42 | Complete |
| PROXY-03 | Phase 42 | Complete |
| PROXY-04 | Phase 42 | Complete |

**Coverage:** 16/16 requirements satisfied (100%)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Kubernetes manifests | Future milestone â€” compose first |
| CI/CD pipeline | Separate concern, not part of compose setup |
| External/managed database | Both profiles use local Postgres containers |
| Let's Encrypt / ACME | Self-signed sufficient for initial deployment |
| Container registry publishing | Not needed for single-server compose |
| Docker Swarm | Going straight to k8s after compose |

---
*Requirements defined: 2026-02-14*
*Archived: 2026-02-14 after v1.8 completion*
