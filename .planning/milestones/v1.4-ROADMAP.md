# Roadmap: v1.4 Test Overhaul

## Overview

This milestone establishes an 80% minimum coverage standard across the codebase. Starting with test infrastructure (fixtures, coverage tools, CI parallelization), we systematically address under-tested backend packages, add API testing layers, cover critical frontend hooks/components, and stabilize flaky E2E tests. The result is a test suite that catches regressions early and runs fast in CI.

## Phases

**Phase Numbering:**
- Continues from v1.3 (ended at Phase 21)
- Phases 22-26 for v1.4

- [ ] **Phase 22: Test Infrastructure Setup** - Foundations for all testing work
- [ ] **Phase 23: Backend Business Logic Tests** - Bring 6 packages to 80%+ coverage
- [ ] **Phase 24: Backend API Testing** - Handler unit tests and integration tests
- [ ] **Phase 25: Frontend Unit Testing** - Critical hooks and components
- [ ] **Phase 26: E2E Stability and Coverage** - Fix flaky tests and fill gaps

## Phase Details

### Phase 22: Test Infrastructure Setup
**Goal**: Testing foundations enable fast, reliable test development across all layers
**Depends on**: Nothing (first phase of milestone)
**Requirements**: INFRA-01, INFRA-02, INFRA-03, INFRA-04, INFRA-05
**Success Criteria** (what must be TRUE):
  1. CI test runs complete in under 5 minutes with parallel execution
  2. Go test can create any entity (item, location, container, etc.) with one factory call
  3. Frontend coverage reports show line/branch coverage percentages
  4. Frontend tests can mock offline state and sync behavior with provided utilities
  5. Coverage badges display current percentages in repository
**Plans**: TBD

Plans:
- [ ] 22-01: Go test factories for common entities
- [ ] 22-02: Frontend coverage and mock utilities setup
- [ ] 22-03: CI parallelization and coverage reporting

### Phase 23: Backend Business Logic Tests
**Goal**: Critical backend packages have comprehensive test coverage preventing regressions
**Depends on**: Phase 22 (needs test factories)
**Requirements**: BE-01, BE-02, BE-03, BE-04, BE-05, BE-06
**Success Criteria** (what must be TRUE):
  1. Import/export package handles CSV parsing edge cases (empty rows, malformed data, encoding)
  2. Pending changes package correctly queues, approves, and rejects changes across all entity types
  3. Import job package tracks progress, handles failures, and cleans up correctly
  4. Jobs package schedules, executes, and reports status for background tasks
  5. Item photo package processes uploads, generates thumbnails, and handles errors
  6. Repair log package creates entries, links photos, and calculates costs correctly
**Plans**: TBD

Plans:
- [ ] 23-01: Import/export package tests (BE-01)
- [ ] 23-02: Pending changes package tests (BE-02)
- [ ] 23-03: Import job package tests (BE-03)
- [ ] 23-04: Jobs package tests (BE-04)
- [ ] 23-05: Item photo package tests (BE-05)
- [ ] 23-06: Repair log package tests (BE-06)

### Phase 24: Backend API Testing
**Goal**: API layer has unit and integration tests ensuring request handling correctness
**Depends on**: Phase 22 (needs test factories), Phase 23 (patterns established)
**Requirements**: API-01, API-02, API-03
**Success Criteria** (what must be TRUE):
  1. Handler unit tests verify business logic delegation without database
  2. Integration tests exercise full request/response cycles against test database
  3. Invalid request payloads return appropriate 4xx errors with clear messages
  4. Authentication and authorization rules are tested per endpoint
**Plans**: TBD

Plans:
- [ ] 24-01: Handler unit test infrastructure and patterns
- [ ] 24-02: Critical flow integration tests
- [ ] 24-03: Request/response validation tests

### Phase 25: Frontend Unit Testing
**Goal**: Critical frontend hooks and components have tests preventing sync and UI regressions
**Depends on**: Phase 22 (needs mock utilities)
**Requirements**: FE-01, FE-02, FE-03, FE-04, FE-05
**Success Criteria** (what must be TRUE):
  1. useOfflineMutation tests cover queue, retry, conflict, and network state scenarios
  2. SyncManager tests verify ordering, batching, error handling, and recovery
  3. Form hooks tests verify multi-step navigation, validation, and state persistence
  4. BarcodeScanner tests verify camera interaction, decode callbacks, and error states
  5. FloatingActionButton tests verify radial menu expansion, item selection, and gestures
**Plans**: TBD

Plans:
- [ ] 25-01: useOfflineMutation hook tests
- [ ] 25-02: SyncManager comprehensive tests
- [ ] 25-03: Form hooks tests
- [ ] 25-04: BarcodeScanner component tests
- [ ] 25-05: FloatingActionButton component tests

### Phase 26: E2E Stability and Coverage
**Goal**: E2E test suite runs reliably and covers critical user flows
**Depends on**: Phase 25 (unit tests stable first)
**Requirements**: E2E-01, E2E-02, E2E-03
**Success Criteria** (what must be TRUE):
  1. Auth setup completes within 5 seconds and tests never fail due to auth timing
  2. Test suite passes 10 consecutive runs without flaky failures
  3. User can complete item CRUD, inventory management, and loan flows in E2E tests
  4. Coverage gaps documented and prioritized for future work
**Plans**: TBD

Plans:
- [ ] 26-01: Auth setup timing fix
- [ ] 26-02: Flaky test identification and stabilization
- [ ] 26-03: Missing user flow tests

## Progress

**Execution Order:**
Phases execute in numeric order: 22 -> 23 -> 24 -> 25 -> 26

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 22. Test Infrastructure Setup | 0/3 | Not started | - |
| 23. Backend Business Logic Tests | 0/6 | Not started | - |
| 24. Backend API Testing | 0/3 | Not started | - |
| 25. Frontend Unit Testing | 0/5 | Not started | - |
| 26. E2E Stability and Coverage | 0/3 | Not started | - |

**Total:** 0/20 plans complete

---
*Roadmap created: 2026-01-31*
*Last updated: 2026-01-31*
