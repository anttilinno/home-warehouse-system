# Milestone v1.2: Phase 2 Completion

**Status:** SHIPPED 2026-01-25
**Phases:** 12-17
**Total Plans:** 19

## Overview

Enhanced item lifecycle management with repair tracking, declutter assistance, photo processing improvements, and comprehensive SSE test coverage.

## Phases

### Phase 12: Repair Log Foundation

**Goal**: Users can track repair history for inventory items with full lifecycle management
**Depends on**: Nothing (standalone feature)
**Plans**: 3 plans

Plans:
- [x] 12-01: Database schema, sqlc queries, domain entity with status workflow
- [x] 12-02: Service with inventory condition updates, HTTP handlers, SSE events
- [x] 12-03: Frontend types, API client, repair history component integration

**Details:**
- Repair status workflow: PENDING -> IN_PROGRESS -> COMPLETED
- Inventory condition auto-update on repair completion
- RepairHistory component with row-action-dialog pattern

### Phase 13: Repair Log Extensions

**Goal**: Users can fully document repairs with photos, attachments, cost tracking, and maintenance reminders
**Depends on**: Phase 12
**Plans**: 4 plans

Plans:
- [x] 13-01: Database schema extensions (repair_photos, repair_attachments, warranty/reminder columns)
- [x] 13-02: Repair photo domain and API, extended repairlog for warranty/reminders
- [x] 13-03: Repair attachment domain and maintenance reminder background job
- [x] 13-04: Frontend photo upload, attachment linking, cost display, warranty/reminder UI

**Details:**
- BEFORE/DURING/AFTER photo categorization
- Multi-currency cost aggregation with GROUP BY
- Dual notification delivery (push + in-app) for reminders
- Reused existing file infrastructure for attachments

### Phase 14: Declutter Assistant

**Goal**: Users can identify and act on unused items to reduce inventory clutter
**Depends on**: Nothing (standalone feature)
**Plans**: 3 plans

Plans:
- [x] 14-01: Database schema (last_used_at column), sqlc queries for unused items
- [x] 14-02: Backend declutter domain (entity, service, repository, handlers)
- [x] 14-03: Frontend declutter page with filters, grouping, mark-as-used, export

**Details:**
- last_used_at column with partial index for efficient queries
- Declutter score = age factor (0-100) + inverse value factor (0-50)
- DeclutterScoreBadge thresholds: 0-50 low, 51-100 medium, 101-150 high
- Loan return automatically updates last_used_at

### Phase 15: Background Thumbnail Processing

**Goal**: Photo uploads are non-blocking with async thumbnail generation and status feedback
**Depends on**: Nothing (standalone infrastructure)
**Plans**: 3 plans

Plans:
- [x] 15-01: Database schema (thumbnail_status, multi-size paths), sqlc queries, entity updates
- [x] 15-02: Asynq thumbnail processor, scheduler registration, async upload service
- [x] 15-03: Frontend thumbnail status types, PhotoThumbnail component, SSE handling

**Details:**
- VARCHAR with CHECK constraint for thumbnail_status
- Partial index for pending/processing status
- SetAsynqClient() setter pattern for optional job queue
- SSE subscription in useItemPhotos hook for real-time updates

### Phase 16: Bulk Photo Operations

**Goal**: Users can efficiently manage multiple photos at once
**Depends on**: Phase 15
**Plans**: 2 plans

Plans:
- [x] 16-01: Database schema (perceptual_hash), sqlc queries, backend bulk endpoints
- [x] 16-02: Frontend selection mode, bulk action bar, duplicate warning dialog

**Details:**
- dHash (difference hash) for perceptual hashing - 64-bit BIGINT
- Hamming distance threshold of 10 for duplicate detection
- Streaming zip for photo download (no memory buffering)
- useBulkSelection<string> for photo ID selection state

### Phase 17: Testing & Polish

**Goal**: SSE event publishing fully tested across all handlers with documented import workflow
**Depends on**: Nothing (testing is independent)
**Plans**: 4 plans

Plans:
- [x] 17-01: SSE tests for borrower, company, label handlers
- [x] 17-02: SSE tests for location, container, category handlers
- [x] 17-03: SSE tests for inventory, favorite, attachment handlers
- [x] 17-04: Import testing checklist and full test suite verification

**Details:**
- SSE test pattern with EventCapture for handler tests
- Inventory operations emit inventory.updated (not specialized event types)
- 8 test scenarios for import workflow manual testing
- 47 SSE tests across 11 handlers

---

## Milestone Summary

**Key Decisions:**

- Repair status workflow: PENDING -> IN_PROGRESS -> COMPLETED
- BEFORE/DURING/AFTER enum for repair photo categorization
- Multi-currency cost aggregation with GROUP BY currency_code
- last_used_at column for declutter tracking with partial index
- Declutter score = age factor (0-100) + inverse value factor (0-50)
- VARCHAR with CHECK constraint for thumbnail_status (easier to modify)
- dHash for perceptual hashing - fast, 64-bit, BIGINT compatible
- SSE test pattern with EventCapture for handler tests

**Issues Resolved:**

- Repair tracking for inventory items
- Unused item identification and management
- Slow photo uploads due to blocking thumbnail generation
- Difficult bulk photo management

**Issues Deferred:**

- Preventive maintenance scheduling (calendar-based) — REPR-F1
- Seasonal awareness for declutter suggestions — DECL-F1
- Estimated resale value lookup — DECL-F2
- Batch thumbnail reprocessing admin tool — PHOT-F1

**Technical Debt Incurred:**

- Linear retry delay in thumbnail processing instead of exponential backoff
- No VERIFICATION.md for Phase 17 (tests serve as verification)

---

*For current project status, see .planning/ROADMAP.md*
