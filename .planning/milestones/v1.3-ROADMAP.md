# Milestone v1.3: Mobile UX Overhaul

**Status:** SHIPPED 2026-01-31
**Phases:** 18-21
**Total Plans:** 22

## Overview

Transform the PWA into a warehouse-grade mobile inventory tool with barcode scanning, offline-capable fuzzy search, floating action buttons with radial menus, and mobile-optimized forms.

## Phases

### Phase 18: Fuzzy Search Infrastructure

**Goal:** Users can find items instantly despite typos, works completely offline
**Depends on:** None (pure infrastructure)
**Plans:** 4 plans

Plans:
- [x] 18-01: Install Fuse.js and enhance search touch targets (SRCH-05)
- [x] 18-02: Create Fuse index builders per entity type
- [x] 18-03: Create offline search module with pending mutations merge
- [x] 18-04: Enhance useGlobalSearch with offline mode detection

**Requirements Delivered:** SRCH-01, SRCH-02, SRCH-03, SRCH-04, SRCH-05, SRCH-06

**Key Deliverables:**
- Fuse.js v7.1.0 integration with IndexedDB
- Enhanced use-global-search.ts hook with offline mode detection
- Fuse index builders per entity store (items, inventory, locations, containers, borrowers, categories)
- Memoized Fuse instances to avoid re-indexing on every render
- Debounced search input (300ms) with useMemo optimization
- Hybrid query approach (IndexedDB filters → Fuse on subset)

---

### Phase 19: Barcode Scanning

**Goal:** Users can scan items and take immediate action without manual searching
**Depends on:** Phase 18 (offline fuzzy search for code lookup)
**Plans:** 6 plans

Plans:
- [x] 19-01: Install dependencies and create scanner infrastructure
- [x] 19-02: Create scan lookup and history modules
- [x] 19-03: Create BarcodeScanner component
- [x] 19-04: Create QuickActionMenu, ManualEntry, and History components
- [x] 19-05: Create scan page with integrated flow
- [x] 19-06: Human verification of scanner on device (deferred to manual testing)

**Requirements Delivered:** SCAN-01, SCAN-02, SCAN-03, SCAN-04, SCAN-05, SCAN-06, SCAN-07

**Key Deliverables:**
- BarcodeScanner component using @yudiel/react-qr-scanner v2.5.0
- QuickActionMenu component with context-aware actions based on entity type
- IndexedDB lookup by short_code field (items/containers/locations)
- Scan history persistence to localStorage with timestamps
- Manual barcode entry fallback input
- Single-page scan flow to avoid iOS permission revocation
- Torch/flashlight toggle control

---

### Phase 20: Mobile Navigation - FAB and Gestures

**Goal:** Users can access common actions instantly from any screen via floating action button
**Depends on:** Phase 19 (FAB opens scanner)
**Plans:** 5 plans

Plans:
- [x] 20-01: Install dependencies and create haptic utility
- [x] 20-02: Create FAB component with radial menu animation
- [x] 20-03: Create context-aware FAB actions hook
- [x] 20-04: Create long-press selectable list items
- [x] 20-05: Integrate FAB into dashboard layout

**Requirements Delivered:** QACT-01, QACT-02, QACT-03, QACT-04, QACT-05, QACT-06

**Key Deliverables:**
- FloatingActionButton component using shadcn Button + motion v12.27.0
- Radial menu animation with arc positioning (Math.cos/sin)
- @use-gesture/react v10.3.1 for touch handling
- Context-aware action configuration based on current route
- Long-press gesture handler for list items (500ms threshold, 25px cancel on movement)
- Haptic feedback via navigator.vibrate(20) and ios-haptics library
- Mobile breakpoint detection (hidden on desktop)

---

### Phase 21: Mobile Form Improvements

**Goal:** Users can complete forms efficiently on mobile with progressive disclosure and smart defaults
**Depends on:** Phase 19 (inline barcode scan), Phase 20 (FAB to open forms)
**Plans:** 7 plans

Plans:
- [x] 21-01: Create form infrastructure: IndexedDB drafts, smart defaults, iOS keyboard hooks
- [x] 21-02: Create CollapsibleSection and MobileFormField components
- [x] 21-03: Create MultiStepForm wizard infrastructure
- [x] 21-04: Create InlinePhotoCapture component
- [x] 21-05: Create Item wizard with all components integrated
- [x] 21-06: Gap closure: Integrate smart defaults hook into wizard
- [x] 21-07: Gap closure: Integrate iOS keyboard hook into forms

**Requirements Delivered:** FORM-01, FORM-02, FORM-03, FORM-04, FORM-05, FORM-06, FORM-07, FORM-08

**Key Deliverables:**
- MultiStepForm component for complex forms (Create Item wizard: Basic → Details → Photos)
- CollapsibleSection component for progressive disclosure (Advanced fields)
- InlinePhotoCapture component combining camera modal with form field
- Form draft auto-save to IndexedDB on every change
- Smart defaults from recent selections (last used category/location)
- Mobile keyboard handling (inputMode="numeric", inputMode="email", etc.)
- All input fields use min 16px font size to prevent iOS zoom
- Visual Viewport API integration to handle iOS keyboard hiding fixed elements

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Fuse.js v7.1.0 exact version | Reproducible builds, tested configuration | Good — stable fuzzy search |
| 44px touch targets via Tailwind | WCAG compliance, mobile usability | Good — easy to tap |
| @yudiel/react-qr-scanner | Active maintenance, ZXing-based, React-friendly | Good — reliable scanning |
| Single-page scan flow | iOS PWA camera permission persistence | Good — avoids re-permission prompts |
| ios-haptics library | iOS 17.4+ Safari haptic workaround | Good — cross-platform haptics |
| 56px FAB, 44px action items | Material Design standard | Good — familiar UX |
| IndexedDB for form drafts | Survives page reload, more storage than localStorage | Good — robust persistence |
| Visual Viewport API | iOS keyboard hides fixed elements | Good — nav buttons stay visible |

**Issues Resolved:**
- Offline search performance via hybrid IndexedDB + Fuse.js approach
- iOS camera permission volatility via single-page scan flow
- iOS keyboard covering inputs via Visual Viewport API integration
- Form draft recovery via IndexedDB persistence

**Issues Deferred:**
- Move action in scanner shows "Coming soon" toast
- SelectableListItem infrastructure ready but not integrated into list views
- Physical device testing for scanner (documented in pending todos)

**Technical Debt Incurred:**
- Scanner not in sidebar navigation (FAB provides primary access)
- Estonian/Russian translations for some scanner strings
- Selection mode ready but not used in existing lists

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-01-31 as part of v1.3 milestone completion*
