---
phase: 20-mobile-navigation-fab-and-gestures
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/components/fab/floating-action-button.tsx
  - frontend/components/fab/fab-action-item.tsx
  - frontend/components/fab/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees 56px FAB button in bottom-right corner on mobile (md:hidden)"
    - "User taps FAB and sees radial menu expand with staggered animation"
    - "Radial menu items positioned using Math.cos/sin polar coordinates"
    - "FAB has proper ARIA attributes (aria-expanded, aria-haspopup, role)"
  artifacts:
    - path: "frontend/components/fab/floating-action-button.tsx"
      provides: "Main FAB component with radial menu"
      exports: ["FloatingActionButton"]
    - path: "frontend/components/fab/fab-action-item.tsx"
      provides: "Individual radial menu action button"
      exports: ["FABActionItem"]
  key_links:
    - from: "frontend/components/fab/floating-action-button.tsx"
      to: "motion/react"
      via: "import for animations"
      pattern: "import.*motion/react"
---

<objective>
Create FloatingActionButton component with radial menu animation

Purpose: Provide a mobile-only FAB that expands into a radial menu with staggered animations, accessible via keyboard and screen readers
Output: FAB component with radial positioning, motion animations, and ARIA accessibility
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-mobile-navigation-fab-and-gestures/20-RESEARCH.md
@frontend/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FABActionItem component</name>
  <files>frontend/components/fab/fab-action-item.tsx</files>
  <action>
Create the individual action item component at `frontend/components/fab/fab-action-item.tsx`:

```typescript
"use client";

import { motion } from "motion/react";
import { Button } from "@/components/ui/button";

export interface FABAction {
  id: string;
  icon: React.ReactNode;
  label: string;
  onClick: () => void;
}

interface FABActionItemProps {
  action: FABAction;
  x: number;
  y: number;
  onTriggerHaptic?: () => void;
  onClose: () => void;
}

const itemVariants = {
  closed: {
    opacity: 0,
    scale: 0,
    transition: { duration: 0.15 },
  },
  open: {
    opacity: 1,
    scale: 1,
    transition: { type: "spring", stiffness: 400, damping: 25 },
  },
};

export function FABActionItem({
  action,
  x,
  y,
  onTriggerHaptic,
  onClose,
}: FABActionItemProps) {
  const handleClick = () => {
    onTriggerHaptic?.();
    action.onClick();
    onClose();
  };

  return (
    <motion.div
      variants={itemVariants}
      className="absolute"
      style={{
        // Position from center of FAB, offset by half button size (22px for 44px button)
        left: `calc(50% + ${x}px - 22px)`,
        top: `calc(50% + ${y}px - 22px)`,
      }}
    >
      <Button
        size="icon"
        variant="secondary"
        className="h-11 w-11 rounded-full shadow-lg"
        onClick={handleClick}
        role="menuitem"
        aria-label={action.label}
      >
        {action.icon}
      </Button>
    </motion.div>
  );
}
```

Key points:
- 44px touch targets (h-11 w-11 = 44px)
- Uses motion variants for coordinated stagger animation
- Spring physics for natural feel
- role="menuitem" for accessibility
- Position calculated from center point
  </action>
  <verify>
```bash
test -f frontend/components/fab/fab-action-item.tsx && echo "File exists"
```
  </verify>
  <done>FABActionItem component created with spring animations</done>
</task>

<task type="auto">
  <name>Task 2: Create FloatingActionButton component</name>
  <files>frontend/components/fab/floating-action-button.tsx</files>
  <action>
Create the main FAB component at `frontend/components/fab/floating-action-button.tsx`:

```typescript
"use client";

import { useState, useCallback, useEffect } from "react";
import { motion } from "motion/react";
import { Plus } from "lucide-react";
import { Button } from "@/components/ui/button";
import { FABActionItem, type FABAction } from "./fab-action-item";
import { triggerHaptic } from "@/lib/hooks/use-haptic";

interface FloatingActionButtonProps {
  actions: FABAction[];
  /** Distance from center to action items in pixels */
  radius?: number;
  /** Starting angle in radians (default: -PI/2 = top) */
  startAngle?: number;
  /** Arc span in radians (default: PI/2 = 90 degrees) */
  arcAngle?: number;
}

const containerVariants = {
  closed: {
    transition: { staggerChildren: 0.05, staggerDirection: -1 },
  },
  open: {
    transition: { delayChildren: 0.1, staggerChildren: 0.07 },
  },
};

export function FloatingActionButton({
  actions,
  radius = 80,
  startAngle = -Math.PI / 2,
  arcAngle = Math.PI / 2,
}: FloatingActionButtonProps) {
  const [isOpen, setIsOpen] = useState(false);

  const toggle = useCallback(() => {
    triggerHaptic("tap");
    setIsOpen((prev) => !prev);
  }, []);

  const close = useCallback(() => {
    setIsOpen(false);
  }, []);

  // Close on escape key
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape" && isOpen) {
        close();
      }
    };
    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [isOpen, close]);

  // Close when clicking outside
  useEffect(() => {
    if (!isOpen) return;

    const handleClickOutside = (e: MouseEvent) => {
      const target = e.target as HTMLElement;
      if (!target.closest("[data-fab-container]")) {
        close();
      }
    };

    // Delay to avoid closing immediately on open click
    const timer = setTimeout(() => {
      document.addEventListener("click", handleClickOutside);
    }, 100);

    return () => {
      clearTimeout(timer);
      document.removeEventListener("click", handleClickOutside);
    };
  }, [isOpen, close]);

  // Calculate positions for each action using polar coordinates
  const getActionPosition = (index: number) => {
    const itemCount = actions.length;
    // Distribute items evenly across the arc
    const angle =
      itemCount === 1
        ? startAngle
        : startAngle - (arcAngle / (itemCount - 1)) * index;

    return {
      x: Math.cos(angle) * radius,
      y: Math.sin(angle) * radius,
    };
  };

  return (
    <div
      data-fab-container
      className="fixed bottom-4 right-4 z-50 md:hidden"
      role="group"
      aria-label="Quick actions"
    >
      <motion.div
        initial={false}
        animate={isOpen ? "open" : "closed"}
        variants={containerVariants}
        className="relative"
      >
        {/* Radial action items */}
        <div role="menu" aria-label="Quick actions menu" hidden={!isOpen}>
          {actions.map((action, index) => {
            const { x, y } = getActionPosition(index);
            return (
              <FABActionItem
                key={action.id}
                action={action}
                x={x}
                y={y}
                onTriggerHaptic={() => triggerHaptic("tap")}
                onClose={close}
              />
            );
          })}
        </div>

        {/* Main FAB button - 56px standard size */}
        <Button
          size="icon"
          className="h-14 w-14 rounded-full shadow-lg"
          onClick={toggle}
          aria-expanded={isOpen}
          aria-haspopup="menu"
          aria-label={isOpen ? "Close quick actions" : "Open quick actions"}
        >
          <motion.div
            animate={{ rotate: isOpen ? 45 : 0 }}
            transition={{ duration: 0.2 }}
          >
            <Plus className="h-6 w-6" />
          </motion.div>
        </Button>
      </motion.div>
    </div>
  );
}

export type { FABAction };
```

Key points:
- 56px main FAB (h-14 w-14), 44px action items
- Bottom-right positioning with 16px margin (bottom-4 right-4)
- md:hidden - only visible on mobile
- Radial positioning using Math.cos/sin with configurable radius, startAngle, arcAngle
- Staggered animation using motion variants
- Escape key closes menu
- Click outside closes menu
- ARIA: role="group", aria-expanded, aria-haspopup="menu", role="menu", role="menuitem"
- Plus icon rotates 45Â° to form X when open
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit components/fab/floating-action-button.tsx 2>&1 | head -20
```
  </verify>
  <done>FloatingActionButton component created with radial menu and accessibility</done>
</task>

<task type="auto">
  <name>Task 3: Create barrel export</name>
  <files>frontend/components/fab/index.ts</files>
  <action>
Create barrel export at `frontend/components/fab/index.ts`:

```typescript
export { FloatingActionButton, type FABAction } from "./floating-action-button";
export { FABActionItem } from "./fab-action-item";
```
  </action>
  <verify>
```bash
test -f frontend/components/fab/index.ts && echo "File exists"
```
  </verify>
  <done>Barrel export created for FAB components</done>
</task>

</tasks>

<verification>
1. FAB components directory exists: `ls frontend/components/fab/`
2. TypeScript compiles: `cd frontend && npx tsc --noEmit`
3. Components export correctly from barrel
</verification>

<success_criteria>
- FloatingActionButton renders 56px button in bottom-right
- Radial menu expands with staggered spring animation
- Menu items positioned using polar coordinates
- ARIA attributes present (aria-expanded, aria-haspopup, role="menu")
- md:hidden class hides FAB on desktop
- Escape key and click outside close menu
</success_criteria>

<output>
After completion, create `.planning/phases/20-mobile-navigation-fab-and-gestures/20-02-SUMMARY.md`
</output>
