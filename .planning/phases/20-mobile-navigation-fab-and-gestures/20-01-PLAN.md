---
phase: 20-mobile-navigation-fab-and-gestures
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/lib/hooks/use-haptic.ts
autonomous: true

must_haves:
  truths:
    - "Haptic feedback triggers on Android via navigator.vibrate"
    - "Haptic feedback triggers on iOS 17.4+ via ios-haptics checkbox workaround"
    - "useHaptic hook provides tap, success, and error feedback patterns"
  artifacts:
    - path: "frontend/lib/hooks/use-haptic.ts"
      provides: "Cross-platform haptic feedback hook"
      exports: ["useHaptic", "triggerHaptic"]
  key_links:
    - from: "frontend/lib/hooks/use-haptic.ts"
      to: "ios-haptics"
      via: "import"
      pattern: "import.*ios-haptics"
---

<objective>
Install FAB dependencies and create haptic feedback utility

Purpose: Provide cross-platform haptic feedback that works on both Android (navigator.vibrate) and iOS (via ios-haptics library workaround)
Output: Installed dependencies (motion, use-long-press, ios-haptics) and useHaptic hook
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-mobile-navigation-fab-and-gestures/20-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install FAB dependencies</name>
  <files>frontend/package.json</files>
  <action>
Install three new dependencies for Phase 20:

```bash
cd frontend && bun add motion use-long-press ios-haptics
```

- motion (formerly framer-motion) - Already documented in research as v12.27.0+
- use-long-press ^3.2.0 - Long press gesture detection
- ios-haptics ^1.0.0 - Cross-platform haptic feedback with iOS Safari workaround
  </action>
  <verify>
```bash
cd frontend && grep -E '"motion"|"use-long-press"|"ios-haptics"' package.json
```
All three packages should appear in dependencies.
  </verify>
  <done>Dependencies installed in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create useHaptic hook</name>
  <files>frontend/lib/hooks/use-haptic.ts</files>
  <action>
Create a cross-platform haptic feedback hook at `frontend/lib/hooks/use-haptic.ts`:

```typescript
"use client";

import { useCallback } from "react";
import { haptic } from "ios-haptics";

export type HapticPattern = "tap" | "success" | "error";

/**
 * Cross-platform haptic feedback hook
 * Uses ios-haptics library which works on:
 * - iOS 17.4+ Safari via hidden checkbox switch workaround
 * - Android via navigator.vibrate fallback
 */
export function useHaptic() {
  const triggerHaptic = useCallback((pattern: HapticPattern = "tap") => {
    try {
      switch (pattern) {
        case "success":
          haptic.confirm();
          break;
        case "error":
          haptic.error();
          break;
        case "tap":
        default:
          haptic();
      }
    } catch {
      // Silently fail if haptics not supported
    }
  }, []);

  return { triggerHaptic };
}

/**
 * Direct haptic trigger for use outside React components
 * @param pattern - Type of haptic feedback
 */
export function triggerHaptic(pattern: HapticPattern = "tap"): void {
  try {
    switch (pattern) {
      case "success":
        haptic.confirm();
        break;
      case "error":
        haptic.error();
        break;
      case "tap":
      default:
        haptic();
    }
  } catch {
    // Silently fail if haptics not supported
  }
}
```

Key points:
- Wraps ios-haptics library which handles iOS Safari's lack of navigator.vibrate
- Provides three patterns: tap (single pulse), success (double pulse), error (triple pulse)
- Both hook version and direct function for flexibility
- Silent failure when haptics unavailable (desktop, older iOS)
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit lib/hooks/use-haptic.ts 2>&1 | head -20
```
Should compile without TypeScript errors.
  </verify>
  <done>useHaptic hook created with tap/success/error patterns</done>
</task>

</tasks>

<verification>
1. `cd frontend && bun install` completes without errors
2. TypeScript compilation passes: `cd frontend && npx tsc --noEmit`
3. Grep confirms all three packages in package.json
</verification>

<success_criteria>
- motion, use-long-press, ios-haptics in frontend/package.json
- useHaptic hook exports triggerHaptic function
- Hook provides tap, success, error haptic patterns
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-mobile-navigation-fab-and-gestures/20-01-SUMMARY.md`
</output>
