---
phase: 31-format-settings-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/components/settings/time-format-settings.tsx
  - frontend/components/settings/date-format-settings.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx
  - frontend/messages/en.json
autonomous: true

must_haves:
  truths:
    - "User can select 12-hour or 24-hour time format from the settings page"
    - "User sees a live preview of the current time in their chosen format next to each option"
    - "Time format selection saves immediately and applies without page reload"
    - "DateFormatSettings is visible on the settings page (was previously not wired)"
  artifacts:
    - path: "frontend/components/settings/time-format-settings.tsx"
      provides: "TimeFormatSettings component with RadioGroup and live preview"
      contains: "RadioGroup"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx"
      provides: "Settings page with DateFormatSettings and TimeFormatSettings rendered"
      contains: "TimeFormatSettings"
    - path: "frontend/messages/en.json"
      provides: "Translation keys for timeFormat section"
      contains: "timeFormat"
  key_links:
    - from: "frontend/components/settings/time-format-settings.tsx"
      to: "/users/me/preferences"
      via: "fetch PATCH on RadioGroup change"
      pattern: "PATCH.*preferences.*time_format"
    - from: "frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx"
      to: "frontend/components/settings/time-format-settings.tsx"
      via: "import and render"
      pattern: "import.*TimeFormatSettings"
---

<objective>
Create the TimeFormatSettings component and wire both DateFormatSettings and TimeFormatSettings to the settings page.

Purpose: Users need a UI to configure their time format preference (12h/24h) with live preview, and the existing DateFormatSettings component needs to be rendered on the settings page (it was created but never wired). This satisfies SETTINGS-02, TIME-05, and partially SETTINGS-01 and SETTINGS-04.

Output: TimeFormatSettings component, updated settings page with date and time format cards, translation keys for time format section.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-format-settings-ui/31-RESEARCH.md
@.planning/phases/30-format-infrastructure/30-02-SUMMARY.md

Key source files to reference:
@frontend/components/settings/date-format-settings.tsx  (PATTERN - replicate this structure exactly)
@frontend/lib/hooks/use-time-format.ts  (TimeFormatOption type, TIME_FORMAT_MAP)
@frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx  (settings page to modify)
@frontend/messages/en.json  (translation keys)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimeFormatSettings component</name>
  <files>
    frontend/components/settings/time-format-settings.tsx
    frontend/messages/en.json
  </files>
  <action>
Create `frontend/components/settings/time-format-settings.tsx` following the exact pattern of `date-format-settings.tsx`:

1. **Component structure:** Card with CardHeader (Clock icon from lucide-react, title, description) and CardContent with RadioGroup.

2. **Options array:**
```typescript
const TIME_FORMAT_OPTIONS = [
  { value: "24h", dateFns: "HH:mm" },
  { value: "12h", dateFns: "h:mm a" },
];
```
These values must match the `TimeFormatOption` type from `use-time-format.ts`.

3. **State and behavior:**
   - Get current time format from `useAuth()` user object: `user?.time_format || "24h"` (default 24h matches hook default)
   - `isUpdating` state to disable RadioGroup during save
   - `handleChange(value: string)` that:
     - Skips if value === currentFormat
     - Sets isUpdating=true
     - PATCHes `${process.env.NEXT_PUBLIC_API_URL}/users/me/preferences` with `{ time_format: value }`
     - Uses same auth headers pattern as DateFormatSettings (Bearer token from localStorage)
     - Calls `refreshUser()` after successful save
     - Shows toast.success/error using translations
     - Sets isUpdating=false in finally

4. **Live preview:** Each RadioGroup option shows the current time formatted with that option's dateFns pattern. Use `format(new Date(), option.dateFns)` from date-fns. This is simpler than DateFormatSettings since there are only 2 options and no custom format.

5. **RadioGroup item layout** (match DateFormatSettings exactly):
```tsx
<div className="flex items-center space-x-3 rounded-lg border p-3 hover:bg-muted/50 transition-colors">
  <RadioGroupItem value={option.value} id={`time-${option.value}`} />
  <Label htmlFor={`time-${option.value}`} className="flex-1 flex justify-between items-center cursor-pointer">
    <span className="font-medium">{t(option.value)}</span>
    <span className="text-muted-foreground text-sm">
      {format(new Date(), option.dateFns)}
    </span>
  </Label>
</div>
```

6. **Translation keys:** Use `useTranslations("settings.timeFormat")`. Add to `frontend/messages/en.json` inside the `settings` object, after the existing `dateFormat` section:
```json
"timeFormat": {
  "title": "Time Format",
  "description": "Choose how times are displayed throughout the app",
  "24h": "24-hour (14:30)",
  "12h": "12-hour (2:30 PM)",
  "saved": "Time format updated",
  "saveError": "Failed to update time format"
}
```

7. **Imports:** Same pattern as DateFormatSettings - "use client", useState from react, useTranslations from next-intl, Clock from lucide-react, Card components, Label, RadioGroup components, useAuth, toast from sonner, format from date-fns.

Do NOT include custom format input (unlike DateFormatSettings which has it). Time format is strictly 12h or 24h.
  </action>
  <verify>
Run `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit` to verify no type errors. Confirm the component file exists and exports `TimeFormatSettings`.
  </verify>
  <done>TimeFormatSettings component renders a Card with Clock icon, title, description, and RadioGroup with two options (24-hour, 12-hour), each showing live-formatted current time. Changes save immediately via PATCH API. Translation keys added to en.json.</done>
</task>

<task type="auto">
  <name>Task 2: Wire DateFormatSettings and TimeFormatSettings to settings page</name>
  <files>
    frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx
  </files>
  <action>
Update `frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx` to import and render the format settings components:

1. **Add imports:**
```typescript
import { DateFormatSettings } from "@/components/settings/date-format-settings";
import { TimeFormatSettings } from "@/components/settings/time-format-settings";
```

2. **Render format settings cards** between the Data Management card and the Active Sessions card. Place DateFormatSettings first, then TimeFormatSettings, as date is the primary format and time is secondary:
```tsx
{/* Data Management card - existing */}

{/* Format Settings */}
<DateFormatSettings />
<TimeFormatSettings />

{/* Active Sessions card - existing */}
```

3. **Import cleanup:** The existing imports (Database, Smartphone from lucide-react, Card components, etc.) stay as-is. The format settings components manage their own Card wrappers internally.

Note: NumberFormatSettings will be added in plan 02 after TimeFormatSettings.
  </action>
  <verify>
Run `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit` to verify no type errors. The settings page should now render: Page header, Data Management card, DateFormatSettings card, TimeFormatSettings card, Active Sessions card.
  </verify>
  <done>Settings page renders DateFormatSettings and TimeFormatSettings between Data Management and Active Sessions. Both format cards are visible and functional on the settings page.</done>
</task>

</tasks>

<verification>
1. `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit` -- no TypeScript errors
2. `frontend/components/settings/time-format-settings.tsx` exists and exports TimeFormatSettings
3. `frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx` imports both DateFormatSettings and TimeFormatSettings
4. `frontend/messages/en.json` contains `settings.timeFormat` section with title, description, 24h, 12h, saved, saveError keys
5. TimeFormatSettings uses RadioGroup with 2 options, live preview via date-fns format, and immediate save via PATCH API
</verification>

<success_criteria>
- TimeFormatSettings component follows the DateFormatSettings pattern (Card + RadioGroup + live preview + immediate save)
- Settings page shows Date Format and Time Format cards in sequence
- Translation keys present in en.json
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/31-format-settings-ui/31-01-SUMMARY.md`
</output>
