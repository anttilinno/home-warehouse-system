---
phase: 19-barcode-scanning
plan: 06
type: execute
wave: 4
depends_on: ["19-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can scan QR codes with device camera"
    - "User receives audio beep on successful scan"
    - "User sees quick action menu after scan"
    - "User can use manual entry when camera unavailable"
    - "User can view scan history"
  artifacts: []
  key_links: []
---

<objective>
Verify barcode scanning functionality on a real device.

Purpose: Confirm scanner works on mobile devices, especially iOS PWA where camera permissions are volatile.
Output: Verification of all SCAN-* requirements.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-barcode-scanning/19-RESEARCH.md
@.planning/phases/19-barcode-scanning/19-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Start development server and verify build</name>
  <files></files>
  <action>
Start the frontend development server to verify everything compiles:
```bash
cd frontend && bun run dev
```

Check for TypeScript errors and verify the scan page loads without errors.
Navigate to http://localhost:3000/dashboard/scan in a browser.
  </action>
  <verify>
- Dev server starts without errors
- No TypeScript compilation errors
- /dashboard/scan page renders
  </verify>
  <done>Development server running and scan page accessible</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete barcode scanning feature:
- Camera-based QR/barcode scanner using @yudiel/react-qr-scanner
- Quick action menu with context-aware actions (view/loan/move/repair)
- Manual barcode entry fallback
- Scan history with localStorage persistence
- Audio feedback via Web Audio API
- Haptic feedback on Android
- Torch toggle (Chromium browsers only)
  </what-built>
  <how-to-verify>
**Desktop Browser (basic functionality):**
1. Navigate to http://localhost:3000/dashboard/scan
2. Allow camera permission when prompted
3. Verify camera feed displays with finder overlay
4. Verify "Scanning" indicator appears
5. Switch to "Manual" tab and enter a code
6. Verify lookup works (shows not found if no matching items)
7. Switch to "History" tab and verify entry appears

**Mobile Device (full verification) - RECOMMENDED:**
1. Open the app on a mobile device (or use ngrok to expose localhost)
2. Navigate to /dashboard/scan
3. Grant camera permission
4. Scan a QR code or barcode
5. Verify audio beep plays on scan
6. Verify haptic feedback (Android only)
7. Verify quick action menu appears
8. Tap "Scan Again" and verify scanner resumes
9. Test torch toggle button (Android Chrome only)
10. Test manual entry with a known short_code from your database

**iOS PWA Test (if possible):**
1. Add app to home screen on iOS
2. Open PWA and navigate to scan page
3. Grant camera permission
4. Scan a code
5. Tap "Scan Again" - camera should resume WITHOUT re-asking permission
6. This confirms single-page flow works correctly

**Requirements Checklist:**
- [ ] SCAN-01: Camera scans QR and barcodes within 2 seconds
- [ ] SCAN-02: Audio beep plays, haptic vibrates (Android)
- [ ] SCAN-03: Torch toggle works (Android Chrome)
- [ ] SCAN-04: Scan history shows with timestamps
- [ ] SCAN-05: Manual entry allows typing codes
- [ ] SCAN-06: Quick action menu shows after scan
- [ ] SCAN-07: "Not found" shows with create option
  </how-to-verify>
  <resume-signal>
Type "approved" if all requirements pass, or describe issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification confirms:
- Scanner works on target devices
- iOS PWA permission handling correct
- All SCAN-* requirements met
</verification>

<success_criteria>
All SCAN-01 through SCAN-07 requirements verified on real device:
- Camera scanning works
- Feedback (audio/haptic) triggers
- Quick actions functional
- Manual entry works
- History persists
</success_criteria>

<output>
After completion, create `.planning/phases/19-barcode-scanning/19-06-SUMMARY.md`
</output>
