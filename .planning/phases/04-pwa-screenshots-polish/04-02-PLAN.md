---
phase: 04-pwa-screenshots-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/components/pwa/offline-indicator.tsx
  - frontend/lib/hooks/use-network-status.ts
autonomous: true

must_haves:
  truths:
    - "Offline indicator shows subtle cloud-off icon in header when offline"
    - "Offline indicator pulses briefly when transitioning to offline state"
    - "Offline indicator is not visible when online"
    - "Indicator includes tooltip explaining offline status"
  artifacts:
    - path: "frontend/components/pwa/offline-indicator.tsx"
      provides: "Icon-only offline indicator with pulse animation"
      exports: ["OfflineIndicator"]
      contains: "data-testid=\"offline-indicator\""
  key_links:
    - from: "frontend/components/pwa/offline-indicator.tsx"
      to: "frontend/lib/hooks/use-network-status.ts"
      via: "useNetworkStatus hook"
      pattern: "useNetworkStatus"
---

<objective>
Enhance offline indicator to be subtle icon-only with attention-getting transition.

Purpose: Per user decision, the offline indicator should be a small icon/badge in the header area, noticeable but not intrusive. A brief pulse or color flash when connectivity changes draws attention without being disruptive.

Output: Updated OfflineIndicator component with CloudOff icon, animate-ping transition, tooltip, and data-testid for E2E testing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pwa-screenshots-polish/04-CONTEXT.md
@.planning/phases/04-pwa-screenshots-polish/04-RESEARCH.md

@frontend/components/pwa/offline-indicator.tsx
@frontend/lib/hooks/use-network-status.ts
@frontend/components/sync-status-indicator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance OfflineIndicator with icon-only design</name>
  <files>frontend/components/pwa/offline-indicator.tsx</files>
  <action>
Refactor OfflineIndicator from full-width banner to subtle icon-only indicator.

Current state: Full-width banner with WifiOff icon and text, green "back online" banner.

Target state per user decisions:
- Subtle icon-only display (CloudOff icon, no text label)
- Header/navbar positioning (component just renders the icon, positioning is parent's job)
- Brief pulse animation when transitioning to offline
- Tooltip on hover explaining "You are offline"
- data-testid="offline-indicator" for E2E testing
- No "back online" banner (too intrusive per user decision for subtle style)

Implementation pattern from research:
```typescript
export function OfflineIndicator() {
  const { isOffline } = useNetworkStatus();
  const [showPulse, setShowPulse] = useState(false);

  useEffect(() => {
    if (isOffline) {
      setShowPulse(true);
      const timer = setTimeout(() => setShowPulse(false), 2000);
      return () => clearTimeout(timer);
    }
  }, [isOffline]);

  if (!isOffline) return null;

  return (
    <Tooltip>
      <TooltipTrigger asChild>
        <div
          className="relative"
          data-testid="offline-indicator"
          role="status"
          aria-label="You are offline"
        >
          {showPulse && (
            <span className="absolute inset-0 animate-ping rounded-full bg-amber-400 opacity-75" />
          )}
          <CloudOff className={cn("h-4 w-4 text-amber-500", showPulse && "animate-pulse")} />
        </div>
      </TooltipTrigger>
      <TooltipContent>You are offline</TooltipContent>
    </Tooltip>
  );
}
```

Key changes:
- Remove banner styling (bg-destructive, full width, etc.)
- Remove "back online" green banner (wasOffline state)
- Add pulse animation on offline transition
- Wrap in Tooltip for accessibility
- Add data-testid for testing
- Keep aria-label for screen readers
- Icon color: amber-500 (warning, not destructive)
  </action>
  <verify>
1. Component renders CloudOff icon when offline (DevTools > Network > Offline)
2. Tooltip shows "You are offline" on hover
3. Pulse animation triggers when going offline
4. Nothing renders when online
5. data-testid="offline-indicator" present in DOM when offline

Manual test steps:
- Open DevTools > Network tab
- Check "Offline" checkbox
- Verify CloudOff icon appears in header with brief pulse
- Hover to see tooltip
- Uncheck "Offline"
- Verify icon disappears
  </verify>
  <done>
- OfflineIndicator shows subtle CloudOff icon (h-4 w-4) when offline
- Pulse animation plays for 2 seconds when transitioning to offline
- Tooltip displays "You are offline" on hover
- data-testid="offline-indicator" present for E2E testing
- Nothing renders when online (returns null)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update network status hook if needed</name>
  <files>frontend/lib/hooks/use-network-status.ts</files>
  <action>
Review use-network-status.ts to ensure it provides the needed state for the enhanced indicator.

Required state:
- isOffline: boolean - current network status
- wasOffline: boolean - was offline in recent past (may no longer be needed for subtle indicator)

The hook should:
1. Track navigator.onLine state
2. Listen to online/offline events
3. Handle SSR (navigator not available on server)

If the hook already provides isOffline, no changes needed. The wasOffline state was used for the "back online" banner which we're removing, so it can remain but won't be used by the updated indicator.

Check if the hook returns isOffline directly or as !isOnline. Either works, but document which pattern is used.
  </action>
  <verify>
```bash
grep -n "isOffline\|isOnline" frontend/lib/hooks/use-network-status.ts
```

Verify hook exports the needed state:
- Either isOffline directly, or
- isOnline (and consumer uses !isOnline)
  </verify>
  <done>
- Hook provides network status (isOffline or isOnline)
- Hook handles SSR (checks for window/navigator availability)
- Hook listens to online/offline events
  </done>
</task>

</tasks>

<verification>
Overall plan verification:

1. Visual verification (manual):
   - Go offline via DevTools Network tab
   - CloudOff icon appears in appropriate location
   - Icon has amber color (not red/destructive)
   - Pulse animation plays briefly
   - Tooltip shows on hover

2. Code verification:
   - OfflineIndicator exports updated component
   - data-testid="offline-indicator" present
   - Tooltip wrapping for accessibility
   - animate-ping or animate-pulse class used
</verification>

<success_criteria>
- [ ] OfflineIndicator renders CloudOff icon only (no banner/text)
- [ ] Icon uses amber-500 color (subtle warning, not destructive red)
- [ ] Pulse animation (animate-ping) triggers on offline transition
- [ ] Animation stops after ~2 seconds
- [ ] Tooltip shows "You are offline" on hover
- [ ] data-testid="offline-indicator" present for E2E testing
- [ ] Component returns null when online
- [ ] No "back online" banner (removed per subtle design decision)
</success_criteria>

<output>
After completion, create `.planning/phases/04-pwa-screenshots-polish/04-02-SUMMARY.md`
</output>
