---
phase: 04-pwa-screenshots-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/e2e/scripts/generate-screenshots.ts
  - frontend/public/screenshots/mobile-dashboard.png
  - frontend/public/screenshots/desktop-inventory.png
autonomous: true

must_haves:
  truths:
    - "PWA install prompt shows mobile screenshot on Android/Desktop Chrome"
    - "PWA install prompt shows desktop screenshot on Desktop Chrome"
    - "Screenshots display realistic inventory data (not empty states)"
  artifacts:
    - path: "frontend/e2e/scripts/generate-screenshots.ts"
      provides: "Automated screenshot generation script"
      exports: ["generateScreenshots"]
    - path: "frontend/public/screenshots/mobile-dashboard.png"
      provides: "Mobile screenshot for PWA manifest"
      min_size_kb: 50
    - path: "frontend/public/screenshots/desktop-inventory.png"
      provides: "Desktop screenshot for PWA manifest"
      min_size_kb: 100
  key_links:
    - from: "frontend/public/manifest.json"
      to: "frontend/public/screenshots/*.png"
      via: "screenshots array entries"
      pattern: "/screenshots/.*\\.png"
---

<objective>
Generate PWA screenshots for app store install prompts.

Purpose: PWA screenshots enhance the install experience by showing users what the app looks like before installation. Chrome on Android and Desktop uses these for richer install UI.

Output: Mobile screenshot (1080x1920) of dashboard, desktop screenshot (1920x1080) of items page, plus Playwright generation script for reproducibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pwa-screenshots-polish/04-RESEARCH.md

@frontend/public/manifest.json
@frontend/e2e/fixtures/authenticated.ts
@frontend/playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create screenshot generation script</name>
  <files>frontend/e2e/scripts/generate-screenshots.ts</files>
  <action>
Create a Playwright script that generates PWA screenshots with controlled viewport and realistic mock data.

The script should:
1. Use Chromium browser (headless)
2. Authenticate using the existing auth setup (read storage state from playwright/.auth/user.json)
3. Navigate to dashboard page, wait for data to load (networkidle)
4. Capture mobile screenshot (1080x1920, deviceScaleFactor: 1) at /en/dashboard
5. Capture desktop screenshot (1920x1080, deviceScaleFactor: 1) at /en/dashboard/items

Key implementation details:
- Use `chromium.launch()` not test runner - this is a standalone script
- Create separate browser contexts for mobile and desktop viewports
- Wait for `networkidle` to ensure data is rendered
- Save to `public/screenshots/` directory
- Use exact dimensions specified in manifest.json (1080x1920 narrow, 1920x1080 wide)

Export a main function and also run directly when executed with `npx tsx`.

Pattern from research:
```typescript
const mobileContext = await browser.newContext({
  viewport: { width: 1080, height: 1920 },
  deviceScaleFactor: 1,
  storageState: 'playwright/.auth/user.json',
});
```
  </action>
  <verify>
Run the script:
```bash
cd frontend && npx tsx e2e/scripts/generate-screenshots.ts
```
Verify screenshots exist and have correct dimensions:
```bash
file public/screenshots/mobile-dashboard.png
file public/screenshots/desktop-inventory.png
```
  </verify>
  <done>
Script executes successfully and generates two PNG files:
- mobile-dashboard.png: 1080x1920 pixels
- desktop-inventory.png: 1920x1080 pixels
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate and verify screenshots</name>
  <files>
frontend/public/screenshots/mobile-dashboard.png
frontend/public/screenshots/desktop-inventory.png
  </files>
  <action>
Execute the screenshot generation script to create the actual PWA screenshots.

Before running:
1. Ensure backend and frontend servers are running (mise run dev, mise run fe-dev)
2. Ensure auth setup has been run (npx playwright test auth.setup.ts)
3. Ensure test user has some inventory data (items, locations, containers)

After generation, verify the manifest.json screenshot entries match:
- src: "/screenshots/mobile-dashboard.png", sizes: "1080x1920", form_factor: "narrow"
- src: "/screenshots/desktop-inventory.png", sizes: "1920x1080", form_factor: "wide"

If the test environment lacks realistic data, the script should still capture whatever is displayed - the screenshots should show the app's actual state.
  </action>
  <verify>
1. Verify files exist and are valid images:
```bash
ls -la frontend/public/screenshots/
file frontend/public/screenshots/*.png
```

2. Verify image dimensions (requires ImageMagick identify or similar):
```bash
identify frontend/public/screenshots/mobile-dashboard.png
identify frontend/public/screenshots/desktop-inventory.png
```

3. Verify manifest references are correct:
```bash
grep -A2 "mobile-dashboard" frontend/public/manifest.json
grep -A2 "desktop-inventory" frontend/public/manifest.json
```
  </verify>
  <done>
- mobile-dashboard.png exists with dimensions 1080x1920
- desktop-inventory.png exists with dimensions 1920x1080
- manifest.json screenshot entries reference correct paths and dimensions
  </done>
</task>

</tasks>

<verification>
Overall plan verification:

1. Screenshot files exist in correct location:
   - frontend/public/screenshots/mobile-dashboard.png
   - frontend/public/screenshots/desktop-inventory.png

2. Screenshots have correct dimensions:
   - Mobile: 1080x1920 (narrow form factor)
   - Desktop: 1920x1080 (wide form factor)

3. PWA manifest references screenshots correctly (already configured in manifest.json)

4. Generation script is reproducible:
   - Running `npx tsx e2e/scripts/generate-screenshots.ts` regenerates screenshots
</verification>

<success_criteria>
- [ ] Screenshot generation script exists at frontend/e2e/scripts/generate-screenshots.ts
- [ ] mobile-dashboard.png exists with 1080x1920 dimensions
- [ ] desktop-inventory.png exists with 1920x1080 dimensions
- [ ] Script can be re-run to regenerate screenshots
- [ ] manifest.json screenshot entries reference correct files
</success_criteria>

<output>
After completion, create `.planning/phases/04-pwa-screenshots-polish/04-01-SUMMARY.md`
</output>
