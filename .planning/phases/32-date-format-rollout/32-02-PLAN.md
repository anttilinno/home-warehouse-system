---
phase: 32-date-format-rollout
plan: 02
type: execute
wave: 2
depends_on: ["32-01"]
files_modified:
  - frontend/app/[locale]/(dashboard)/dashboard/loans/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/sync-history/page.tsx
  - frontend/components/inventory/repair-history.tsx
autonomous: true

must_haves:
  truths:
    - "Date input labels show user's chosen format as a hint (e.g., 'Due Date (dd/mm/yyyy)')"
    - "Form validation messages reference user's chosen format"
    - "Native date input value attributes remain yyyy-MM-dd (browser spec unchanged)"
  artifacts:
    - path: "frontend/app/[locale]/(dashboard)/dashboard/loans/page.tsx"
      provides: "Loan date inputs with format hints in labels"
      contains: "placeholder"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/sync-history/page.tsx"
      provides: "Sync history date filters with format hints"
      contains: "useDateFormat"
    - path: "frontend/components/inventory/repair-history.tsx"
      provides: "Repair date inputs with format hints"
      contains: "placeholder"
  key_links:
    - from: "frontend/app/[locale]/(dashboard)/dashboard/loans/page.tsx"
      to: "frontend/lib/hooks/use-date-format.ts"
      via: "placeholder from useDateFormat"
      pattern: "placeholder.*useDateFormat"
    - from: "frontend/components/inventory/repair-history.tsx"
      to: "frontend/lib/hooks/use-date-format.ts"
      via: "placeholder from useDateFormat"
      pattern: "placeholder.*useDateFormat"
---

<objective>
Add user-format-aware labels/hints to all date input fields and format-aware validation messages, completing the date format rollout across inputs.

Purpose: This completes DATE-04 (input placeholders), DATE-05/DATE-06 (partial -- native date inputs handle parsing/output internally, but labels now communicate the expected format), and DATE-08 (validation messages reference user's format). Together with Plan 01, this satisfies all DATE requirements.

Output: Date inputs across loans, sync history, and repair history show format hints. Validation messages reference user's chosen format.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-date-format-rollout/32-RESEARCH.md
@.planning/phases/32-date-format-rollout/32-01-SUMMARY.md
@frontend/lib/hooks/use-date-format.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add format hints to all date input labels</name>
  <files>
    frontend/app/[locale]/(dashboard)/dashboard/loans/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/sync-history/page.tsx
    frontend/components/inventory/repair-history.tsx
  </files>
  <action>
For each file with `<input type="date">` elements, add a format hint showing the user's preferred format in the label or nearby text. The `placeholder` property was added to useDateFormat in Plan 01.

**IMPORTANT:** Native `<input type="date">` always uses browser-locale display and `yyyy-MM-dd` for the value attribute. Do NOT change the value format. The hint is purely informational, telling users what format the system uses elsewhere.

**loans/page.tsx** (7 date inputs):
- Already has `useDateFormat` imported and destructured from Plan 01. Extend destructuring to include `placeholder`: `const { formatDate, placeholder: datePlaceholder } = useDateFormat();`
- For each date input's associated Label, add a hint span. The pattern is:
  ```tsx
  <Label htmlFor="...">Label Text <span className="text-xs text-muted-foreground font-normal">({datePlaceholder})</span></Label>
  ```
- Apply to these date inputs (find the Label element immediately preceding each `<input type="date">`):
  1. Filter section "From" date (~line 296) — find its label, add hint
  2. Filter section "To" date (~line 302) — find its label, add hint
  3. Filter section "Due From" date (~line 315) — find its label, add hint
  4. Filter section "Due To" date (~line 321) — find its label, add hint
  5. Extend due date dialog input (~line 1168) — find its label, add hint
  6. Create loan form "Loan Date" input (~line 1289) — find its label, add hint
  7. Create loan form "Due Date" input (~line 1302) — find its label, add hint

Note: Some of these inputs may use placeholder text in `<Label>` directly or nearby text. Look for the actual label text near each input and add the format hint appropriately.

**sync-history/page.tsx** (2 date inputs at ~lines 245, 257):
- Add `import { useDateFormat } from "@/lib/hooks/use-date-format";`
- Inside the component, add `const { placeholder: datePlaceholder } = useDateFormat();`
- Find the labels for the two date range filter inputs ("From" and "To" or similar) and add format hint spans.

**repair-history.tsx** (2 date inputs at ~lines 540, 616):
- Already has `useDateFormat` imported from Plan 01. Extend destructuring to include `placeholder`: add `placeholder: datePlaceholder` to the existing destructuring.
- Find the labels for the repair date input (~line 540) and reminder date input (~line 616) and add format hint spans.
  </action>
  <verify>Run `cd frontend && npx tsc --noEmit` — no type errors. Grep for `datePlaceholder` in the 3 files — should appear in all three. Count the number of format hints added — should be 11 total (7 loans + 2 sync-history + 2 repair-history).</verify>
  <done>All 11 date input fields across loans, sync history, and repair history show the user's preferred format as a hint in the label.</done>
</task>

<task type="auto">
  <name>Task 2: Add format-aware validation messages</name>
  <files>
    frontend/app/[locale]/(dashboard)/dashboard/loans/page.tsx
    frontend/components/inventory/repair-history.tsx
  </files>
  <action>
Add format-aware validation/error messages for date inputs that have validation logic.

**loans/page.tsx:**
- Search for any date validation logic (e.g., checking if due date is after loaned date, checking date format validity). If toast.error or form error messages reference dates, update them to include the user's format.
- For the extend due date dialog: if there's validation like "New due date must be after current due date", ensure it shows: `Please enter a valid date (${datePlaceholder})` or similar.
- For the create loan form: if there's date validation, update error messages to reference the format.
- If no explicit date validation messages exist beyond HTML5 native validation, add a helper text below date inputs that shows the format hint (only if there's no Label hint already — avoid duplication). If Task 1 already covered hints in Labels, this may be minimal for loans.

**repair-history.tsx:**
- Search for any date validation in the repair form. If validation messages reference dates, update to include format.
- If no explicit validation messages exist, the Label hints from Task 1 are sufficient.

**General approach:** Search each file for:
1. `toast.error` calls mentioning "date"
2. Form validation error state messages mentioning "date"
3. Zod/validation schema date messages

For any found, replace hardcoded format references with `datePlaceholder` from the hook. If none exist (native date inputs handle validation internally), document that DATE-08 is satisfied via the Label hints from Task 1 (which show the expected format).

NOTE: If after investigation there are no explicit date validation error messages in these files (which is likely since they use native `<input type="date">` that handles validation internally), this task's scope is simply to verify and confirm DATE-08 coverage. The Label format hints from Task 1 serve as the format communication mechanism in lieu of traditional validation error messages.
  </action>
  <verify>Run `cd frontend && npx tsc --noEmit` — no type errors. Run `cd frontend && npm run build` — production build succeeds. Grep for any remaining `toLocaleDateString` in modified files — should be zero.</verify>
  <done>Format-aware validation messages reference user's format where applicable. DATE-08 satisfied through Label hints and any explicit validation messages updated.</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` — zero type errors
2. `cd frontend && npm run build` — production build succeeds
3. All date inputs in loans, sync-history, and repair-history show format hints in labels
4. No remaining `toLocaleDateString` calls in converted files
5. Native date input value attributes still use `yyyy-MM-dd` format (verify by grep for `type="date"` and checking adjacent value bindings)
</verification>

<success_criteria>
- Every date input field in the application has a format hint showing user's preferred format
- Native date inputs maintain yyyy-MM-dd for value binding (browser requirement preserved)
- Validation messages (where they exist) reference user's chosen format
- Frontend compiles and builds without errors
- Combined with Plan 01, all DATE-01 through DATE-10 requirements are addressed
</success_criteria>

<output>
After completion, create `.planning/phases/32-date-format-rollout/32-02-SUMMARY.md`
</output>
