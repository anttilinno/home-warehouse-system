---
phase: 30-format-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["30-01"]
files_modified:
  - frontend/lib/api/auth.ts
  - frontend/lib/hooks/use-time-format.ts
  - frontend/lib/hooks/use-number-format.ts
autonomous: true

must_haves:
  truths:
    - "useTimeFormat hook returns user's time format preference (12h or 24h) with formatTime function"
    - "useNumberFormat hook returns user's separator preferences with formatNumber and parseNumber functions"
    - "Hooks fall back to defaults (24h, comma thousands, period decimal) when no preference is set"
    - "Frontend User type includes time_format, thousand_separator, decimal_separator fields"
  artifacts:
    - path: "frontend/lib/hooks/use-time-format.ts"
      provides: "useTimeFormat hook with formatTime and timeFormatString"
      exports: ["useTimeFormat", "TimeFormatOption", "UseTimeFormatReturn"]
    - path: "frontend/lib/hooks/use-number-format.ts"
      provides: "useNumberFormat hook with formatNumber and parseNumber"
      exports: ["useNumberFormat", "ThousandSeparator", "DecimalSeparator", "UseNumberFormatReturn"]
    - path: "frontend/lib/api/auth.ts"
      provides: "Updated User interface with new preference fields"
      contains: "time_format"
  key_links:
    - from: "use-time-format.ts"
      to: "auth-context.tsx"
      via: "useAuth() providing user object with time_format"
      pattern: "user\\?\\.time_format"
    - from: "use-number-format.ts"
      to: "auth-context.tsx"
      via: "useAuth() providing user object with thousand_separator, decimal_separator"
      pattern: "user\\?\\.thousand_separator"
---

<objective>
Create useTimeFormat and useNumberFormat hooks following the exact pattern of the existing useDateFormat hook, and update the frontend User type to include the new preference fields.

Purpose: Make time and number format preferences available to all frontend components via hooks, enabling consistent formatting throughout the application in later phases.
Output: Two new hooks (use-time-format.ts, use-number-format.ts) and updated User interface in auth.ts.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-format-infrastructure/30-RESEARCH.md
@.planning/phases/30-format-infrastructure/30-01-SUMMARY.md

Key source files -- follow the exact pattern of useDateFormat:
@frontend/lib/hooks/use-date-format.ts
@frontend/lib/api/auth.ts
@frontend/lib/contexts/auth-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update User type and create useTimeFormat hook</name>
  <files>
    frontend/lib/api/auth.ts
    frontend/lib/hooks/use-time-format.ts
  </files>
  <action>
    1. Update the User interface in `frontend/lib/api/auth.ts`:
       - Add `time_format: string;` after date_format
       - Add `thousand_separator: string;` after time_format
       - Add `decimal_separator: string;` after thousand_separator

    2. Create `frontend/lib/hooks/use-time-format.ts` following the useDateFormat pattern exactly:
       - "use client" directive at top
       - Import useCallback, useMemo from react
       - Import format as dateFnsFormat, parseISO, isValid from date-fns
       - Import useAuth from @/lib/contexts/auth-context
       - Export type TimeFormatOption = "12h" | "24h"
       - Const DEFAULT_TIME_FORMAT: TimeFormatOption = "24h"
       - Export interface UseTimeFormatReturn with: format (TimeFormatOption), formatTime (function taking Date|string|null|undefined returning string), timeFormatString (string -- the date-fns token: "HH:mm" for 24h, "h:mm a" for 12h)
       - Export function useTimeFormat():
         - Call useAuth() for user
         - useMemo for format: read user?.time_format, validate it's "12h" or "24h", fallback to DEFAULT_TIME_FORMAT
         - Derive timeFormatString: "h:mm a" if 12h, "HH:mm" if 24h
         - useCallback for formatTime: if null/undefined return "-", parse string dates with parseISO, validate with isValid, format with dateFnsFormat using timeFormatString. Catch errors and return "-".
         - Return { format, formatTime, timeFormatString }
  </action>
  <verify>
    - `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit 2>&1 | head -20` shows no type errors in the new/modified files
    - The hook file exports the expected types and function
  </verify>
  <done>
    User interface includes time_format, thousand_separator, decimal_separator. useTimeFormat hook reads user preference, provides formatTime function, and falls back to 24h default.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useNumberFormat hook</name>
  <files>
    frontend/lib/hooks/use-number-format.ts
  </files>
  <action>
    Create `frontend/lib/hooks/use-number-format.ts`:
    - "use client" directive at top
    - Import useCallback, useMemo from react
    - Import useAuth from @/lib/contexts/auth-context
    - Export type ThousandSeparator = "," | "." | " "
    - Export type DecimalSeparator = "." | ","
    - Const DEFAULT_THOUSAND_SEP: ThousandSeparator = ","
    - Const DEFAULT_DECIMAL_SEP: DecimalSeparator = "."
    - Export interface UseNumberFormatReturn with: thousandSeparator, decimalSeparator, formatNumber (value: number, decimals?: number) => string, parseNumber (formatted: string) => number | null
    - Export function useNumberFormat():
      - Call useAuth() for user
      - useMemo for thousandSeparator: read user?.thousand_separator, validate it's one of ",", ".", " ", fallback to DEFAULT_THOUSAND_SEP
      - useMemo for decimalSeparator: read user?.decimal_separator, validate it's "." or ",", fallback to DEFAULT_DECIMAL_SEP
      - useCallback for formatNumber(value, decimals?):
        - Split number into integer and decimal parts using value.toFixed(decimals) or value.toString()
        - Apply thousand separator regex to integer part: parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, thousandSep)
        - Join with decimal separator if decimal part exists
        - Return formatted string
      - useCallback for parseNumber(formatted):
        - Remove all thousand separators with replaceAll
        - Replace decimal separator with "."
        - Parse with Number(), return null if NaN
      - Return { thousandSeparator, decimalSeparator, formatNumber, parseNumber }

    After creating, verify TypeScript compilation:
    `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit 2>&1 | head -20`
  </action>
  <verify>
    - `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit 2>&1 | head -20` shows no type errors
    - The hook file exports useNumberFormat, ThousandSeparator, DecimalSeparator, UseNumberFormatReturn
  </verify>
  <done>
    useNumberFormat hook reads user's separator preferences from auth context, provides formatNumber and parseNumber utilities, and falls back to comma-thousands/period-decimal defaults. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit` passes with zero errors
2. User type includes all three new fields (time_format, thousand_separator, decimal_separator)
3. useTimeFormat exports: TimeFormatOption, UseTimeFormatReturn, useTimeFormat
4. useNumberFormat exports: ThousandSeparator, DecimalSeparator, UseNumberFormatReturn, useNumberFormat
5. Both hooks use useAuth() to read preferences (not localStorage or any other source)
6. Both hooks have sensible defaults when user preference is not set
</verification>

<success_criteria>
- Frontend compiles with zero TypeScript errors
- useTimeFormat hook available and returns formatTime function
- useNumberFormat hook available and returns formatNumber and parseNumber functions
- Hooks use auth context as single source of truth for preferences
- Default values: 24h time, comma thousands, period decimal
- Requirements satisfied: TIME-01, TIME-02, NUM-01, NUM-02, NUM-03, SETTINGS-05
</success_criteria>

<output>
After completion, create `.planning/phases/30-format-infrastructure/30-02-SUMMARY.md`
</output>
