---
phase: 35-settings-shell-and-route-structure
plan: 02
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/profile/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/appearance/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/language/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/regional-formats/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/security/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/notifications/page.tsx
  - frontend/app/[locale]/(dashboard)/dashboard/settings/data-storage/page.tsx
autonomous: false

must_haves:
  truths:
    - "User sees a settings landing page with iOS-style grouped rows showing icons, labels, descriptions, and chevrons"
    - "Each settings row displays a live preview of the current value pulled from user preferences"
    - "Settings organized into sections: Profile card at top, Preferences group, System & Security group"
    - "On mobile, the hub page serves as the navigation entry point"
    - "Tapping any subpage and pressing back returns to the settings hub"
    - "Hub page does NOT render a duplicate h1 (layout provides it)"
  artifacts:
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx"
      provides: "Hub landing page with profile card, grouped SettingsRows, live previews"
      min_lines: 50
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/profile/page.tsx"
      provides: "Profile stub subpage"
      contains: "useTranslations"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/appearance/page.tsx"
      provides: "Appearance stub subpage"
      contains: "useTranslations"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/language/page.tsx"
      provides: "Language stub subpage"
      contains: "useTranslations"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/regional-formats/page.tsx"
      provides: "Regional Formats stub subpage"
      contains: "useTranslations"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/security/page.tsx"
      provides: "Security stub subpage"
      contains: "useTranslations"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/notifications/page.tsx"
      provides: "Notifications stub subpage"
      contains: "useTranslations"
    - path: "frontend/app/[locale]/(dashboard)/dashboard/settings/data-storage/page.tsx"
      provides: "Data & Storage stub subpage"
      contains: "useTranslations"
  key_links:
    - from: "frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx"
      to: "@/components/settings/settings-row"
      via: "SettingsRow import for hub rows"
      pattern: "SettingsRow"
    - from: "frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx"
      to: "@/lib/contexts/auth-context"
      via: "useAuth() for live preview values"
      pattern: "useAuth"
    - from: "frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx"
      to: "@/i18n/config"
      via: "localeNames import for language preview"
      pattern: "localeNames"
    - from: "stub subpages"
      to: "@/i18n/navigation"
      via: "Link for back navigation on mobile"
      pattern: "Link.*@/i18n/navigation"
---

<objective>
Rewrite the settings hub landing page with iOS-style grouped rows and live preview values, and create 7 stub subpages that prove the routing works and provide navigation targets.

Purpose: Completes the hub-and-subpage architecture. Users can navigate to settings, see organized categories with current values, tap into subpages, and navigate back. Future phases (36-39) replace stubs with real content.

Output: Rewritten hub page with profile card + grouped rows + live previews, plus 7 stub subpage files.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-settings-shell-and-route-structure/35-RESEARCH.md
@.planning/phases/35-settings-shell-and-route-structure/35-01-SUMMARY.md
@frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx
@frontend/components/settings/settings-row.tsx
@frontend/components/settings/settings-nav.tsx
@frontend/app/[locale]/(dashboard)/dashboard/settings/layout.tsx
@frontend/lib/api/auth.ts
@frontend/lib/contexts/auth-context.tsx
@frontend/i18n/config.ts
@frontend/i18n/navigation.ts
@frontend/messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite settings hub page with grouped rows and live previews</name>
  <files>
    frontend/app/[locale]/(dashboard)/dashboard/settings/page.tsx
  </files>
  <action>
    Replace the entire contents of `settings/page.tsx` with the hub landing page. The existing 166-line monolithic page is being replaced completely. The layout (from Plan 01) already renders the h1 "Settings" title and description -- the hub page must NOT render its own h1.

    Hub page structure:
    1. "use client" directive
    2. Imports: `useTranslations` from next-intl, icons from lucide-react (`Palette`, `Globe`, `Calendar`, `Shield`, `Bell`, `Database`), `ChevronRight` from lucide-react, `Link` from `@/i18n/navigation`, `Avatar`/`AvatarFallback`/`AvatarImage` from `@/components/ui/avatar`, `Card`/`CardContent` from `@/components/ui/card`, `useAuth` from `@/lib/contexts/auth-context`, `SettingsRow` from `@/components/settings/settings-row`, `localeNames` and `Locale` from `@/i18n/config`
    3. Component body:
       - Get `t` from `useTranslations("settings")`
       - Get `{ user }` from `useAuth()`
       - Compute `initials` from `user?.full_name` (same pattern as current page: split by space, take first char of each, join, toUpperCase, fallback "?")
       - Derive live preview values DIRECTLY in the render path (no useEffect, no useMemo):
         - `themePreview`: check `user?.theme` -- "dark" -> `t("hub.dark")`, "light" -> `t("hub.light")`, else `t("hub.system")`
         - `languagePreview`: `localeNames[(user?.language || "en") as Locale] || "English"`
         - `datePreview`: `user?.date_format || "YYYY-MM-DD"`
       - Notifications and data-storage rows do NOT get preview values in Phase 35 (omit the `preview` prop -- it's optional on SettingsRow)
    4. Render:
       - **Profile Card** at top: `Link` to `/dashboard/settings/profile`, wrapping a `Card` with `hover:bg-muted/50 transition-colors cursor-pointer`. Inside `CardContent` with `flex items-center gap-4 p-4`: Avatar (h-16 w-16) with image and fallback initials, name (font-semibold text-lg) and email (text-sm text-muted-foreground) in flex-1, ChevronRight at end.
       - **Preferences Group**: Section header `<h3 className="text-sm font-medium text-muted-foreground px-1 mb-2">{t("hub.preferences")}</h3>`, then three SettingsRow components:
         - Appearance: icon=Palette, label=t("nav.appearance"), description=t("hub.appearanceDesc"), href="/dashboard/settings/appearance", preview=themePreview
         - Language: icon=Globe, label=t("nav.language"), description=t("hub.languageDesc"), href="/dashboard/settings/language", preview=languagePreview
         - Regional Formats: icon=Calendar, label=t("nav.regionalFormats"), description=t("hub.regionalFormatsDesc"), href="/dashboard/settings/regional-formats", preview=datePreview
       - **System & Security Group**: Section header with `t("hub.systemSecurity")`, then three SettingsRow components:
         - Security: icon=Shield, label=t("nav.security"), description=t("hub.securityDesc"), href="/dashboard/settings/security" (no preview)
         - Notifications: icon=Bell, label=t("nav.notifications"), description=t("hub.notificationsDesc"), href="/dashboard/settings/notifications" (no preview)
         - Data & Storage: icon=Database, label=t("nav.dataStorage"), description=t("hub.dataStorageDesc"), href="/dashboard/settings/data-storage" (no preview)
    5. Wrap sections in `<div className="space-y-6">` for vertical spacing. Each group's rows wrapped in `<div className="space-y-2">`.

    CRITICAL: Do NOT import or render `ProfileEditSheet`, `BackupRestoreDialog`, `ActiveSessions`, `DateFormatSettings`, `TimeFormatSettings`, `NumberFormatSettings`, `Separator`, or any other component from the old page. This is a clean replacement. Those components will be used by their respective subpages in Phases 36-39.
  </action>
  <verify>
    Run `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit --pretty` -- no type errors.
    Confirm the file no longer imports `ProfileEditSheet`, `BackupRestoreDialog`, `ActiveSessions`, or format settings components.
    Confirm the file imports `SettingsRow` and `useAuth`.
  </verify>
  <done>
    Hub page renders: profile card at top linking to /profile, Preferences group (Appearance with theme preview, Language with locale name preview, Regional Formats with date format preview), System & Security group (Security, Notifications, Data & Storage without previews). No duplicate h1 header. All text uses i18n translations. Live previews derive directly from useAuth().user.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 7 stub subpages with back navigation</name>
  <files>
    frontend/app/[locale]/(dashboard)/dashboard/settings/profile/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/settings/appearance/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/settings/language/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/settings/regional-formats/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/settings/security/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/settings/notifications/page.tsx
    frontend/app/[locale]/(dashboard)/dashboard/settings/data-storage/page.tsx
  </files>
  <action>
    Create 7 stub subpage files, each following the same pattern. Each is a "use client" component.

    Template for each stub:
    ```tsx
    "use client";

    import { useTranslations } from "next-intl";
    import { ArrowLeft } from "lucide-react";
    import { Link } from "@/i18n/navigation";

    export default function {PageName}Page() {
      const t = useTranslations("settings");

      return (
        <div className="space-y-6">
          {/* Mobile back link */}
          <Link
            href="/dashboard/settings"
            className="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground md:hidden"
          >
            <ArrowLeft className="h-4 w-4" />
            {t("title")}
          </Link>

          <div>
            <h2 className="text-2xl font-bold tracking-tight">{t("nav.{navKey}")}</h2>
            <p className="text-muted-foreground">{t("comingSoon")}</p>
          </div>
        </div>
      );
    }
    ```

    The 7 pages with their function names and nav keys:
    1. `profile/page.tsx` -- `ProfilePage`, nav key: `"nav.profile"`
    2. `appearance/page.tsx` -- `AppearancePage`, nav key: `"nav.appearance"`
    3. `language/page.tsx` -- `LanguagePage`, nav key: `"nav.language"`
    4. `regional-formats/page.tsx` -- `RegionalFormatsPage`, nav key: `"nav.regionalFormats"`
    5. `security/page.tsx` -- `SecurityPage`, nav key: `"nav.security"`
    6. `notifications/page.tsx` -- `NotificationsPage`, nav key: `"nav.notifications"`
    7. `data-storage/page.tsx` -- `DataStoragePage`, nav key: `"nav.dataStorage"`

    Each stub includes:
    - A mobile-only back link (`md:hidden`) to `/dashboard/settings` using i18n Link with ArrowLeft icon. This is hidden on desktop where the sidebar provides navigation.
    - An h2 heading using the nav translation key (the layout provides h1)
    - "Coming soon" text using the existing `t("comingSoon")` key (already in all 3 locale files)

    Create the directories as needed. All 7 pages use `Link` from `@/i18n/navigation` (NEVER `next/link`).
  </action>
  <verify>
    Run `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && npx tsc --noEmit --pretty` -- no type errors.
    Verify all 7 directories exist: `ls -d app/\[locale\]/\(dashboard\)/dashboard/settings/*/`
    Verify each contains a page.tsx.
  </verify>
  <done>
    Seven stub subpage directories exist under settings/ (profile, appearance, language, regional-formats, security, notifications, data-storage). Each renders a mobile back link, h2 heading, and "Coming soon" text. Routing works: navigating to /dashboard/settings/appearance renders the Appearance stub within the shared settings layout.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete settings hub-and-subpage architecture</name>
  <action>
    Human verification of the complete settings hub-and-subpage architecture built in Tasks 1-2 and Plan 01. Verify hub landing page, desktop sidebar, mobile navigation, live previews, stub subpages, and translations.
  </action>
  <what-built>
    Complete settings hub-and-subpage architecture:
    - Hub landing page with profile card, 6 grouped settings rows with live previews
    - Desktop sidebar navigation with active state
    - 7 stub subpages with mobile back navigation
    - All labels translated in en/et/ru
  </what-built>
  <how-to-verify>
    1. Start frontend dev server: `mise run fe-dev`
    2. Navigate to `/dashboard/settings` -- should see:
       - "Settings" h1 title with description (from layout, NOT duplicated)
       - Profile card at top with avatar, name, email, and chevron
       - "Preferences" group with Appearance (showing theme preview), Language (showing locale name), Regional Formats (showing date format)
       - "System & Security" group with Security, Notifications, Data & Storage
    3. On desktop (>768px), verify sidebar is visible on the left with 8 nav items, "Overview" highlighted
    4. Click "Appearance" row -- should navigate to stub page showing "Appearance" h2 and "Coming soon"
    5. Verify sidebar now highlights "Appearance" (not "Overview")
    6. Click browser back -- should return to hub
    7. Resize to mobile width (<768px):
       - Sidebar should be hidden
       - Hub rows should still be tappable
       - Tap any row, verify mobile back link appears (arrow + "Settings")
       - Tap back link, verify return to hub
    8. Check live previews update: if theme is dark, Appearance row should show "Dark"
  </how-to-verify>
  <verify>Human confirms all 8 verification steps pass</verify>
  <done>Settings hub renders correctly on desktop and mobile with working navigation, live previews, and translations</done>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Hub page renders profile card + 2 groups (Preferences with 3 rows, System & Security with 3 rows)
- Live previews show actual values from user preferences (theme, language, date format)
- No duplicate h1 headers on any page
- Desktop sidebar shows active state correctly (exact match for hub, prefix for subpages)
- Mobile back navigation works from every stub subpage
- All 7 stub routes resolve and render within the shared layout
- Switching locale (et, ru) translates all navigation labels
</verification>

<success_criteria>
- HUB-01: Settings landing page renders iOS-style grouped rows with icons, labels, descriptions, and chevron navigation
- HUB-02: Settings rows show live preview of current value (theme, language, date format)
- HUB-03: Settings grouped into sections: Profile card at top, Preferences group, System & Security group
- HUB-04: Desktop sidebar visible alongside content; mobile uses hub as navigation entry point
- HUB-05: Back navigation from each subpage returns to settings hub
- HUB-06: All navigation labels translated (en, et, ru)
</success_criteria>

<output>
After completion, create `.planning/phases/35-settings-shell-and-route-structure/35-02-SUMMARY.md`
</output>
