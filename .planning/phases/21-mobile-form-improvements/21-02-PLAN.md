---
phase: 21-mobile-form-improvements
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - frontend/components/forms/collapsible-section.tsx
  - frontend/components/forms/mobile-form-field.tsx
  - frontend/components/forms/index.ts
autonomous: true

must_haves:
  truths:
    - "Collapsible sections expand/collapse with animation"
    - "Form fields have 44px minimum touch targets"
    - "Form fields use 16px font size (text-base)"
    - "Labels remain visible above input fields"
    - "Validation errors appear inline next to fields"
  artifacts:
    - path: "frontend/components/forms/collapsible-section.tsx"
      provides: "Progressive disclosure wrapper"
      exports: ["CollapsibleSection"]
    - path: "frontend/components/forms/mobile-form-field.tsx"
      provides: "Mobile-optimized form field"
      exports: ["MobileFormField"]
    - path: "frontend/components/forms/index.ts"
      provides: "Barrel export for forms"
  key_links:
    - from: "frontend/components/forms/collapsible-section.tsx"
      to: "frontend/components/ui/collapsible.tsx"
      via: "import Collapsible"
      pattern: "import.*Collapsible.*from.*ui/collapsible"
    - from: "frontend/components/forms/mobile-form-field.tsx"
      to: "react-hook-form"
      via: "useFormContext"
      pattern: "useFormContext"
---

<objective>
Create reusable mobile form components: CollapsibleSection for progressive disclosure and MobileFormField for touch-optimized inputs.

Purpose: These components implement FORM-01 (progressive disclosure), FORM-03 (44px touch targets), FORM-04 (visible labels), FORM-05 (inline validation), and FORM-08 (16px font size).

Output: Two React components in a new frontend/components/forms directory with barrel export.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-mobile-form-improvements/21-RESEARCH.md
@.planning/phases/21-mobile-form-improvements/21-01-SUMMARY.md

@frontend/components/ui/input.tsx
@frontend/components/ui/label.tsx
@frontend/components/ui/collapsible.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CollapsibleSection component</name>
  <files>
    frontend/components/forms/collapsible-section.tsx
  </files>
  <action>
Create collapsible-section.tsx following research Pattern 3:

```typescript
"use client";

import { useState } from "react";
import { ChevronDown } from "lucide-react";
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible";
import { cn } from "@/lib/utils";

interface CollapsibleSectionProps {
  /** Section title displayed in trigger */
  title: string;
  /** Optional description below title */
  description?: string;
  /** Whether section starts expanded */
  defaultOpen?: boolean;
  /** Section content */
  children: React.ReactNode;
  /** Additional classes for container */
  className?: string;
}

export function CollapsibleSection({
  title,
  description,
  defaultOpen = false,
  children,
  className,
}: CollapsibleSectionProps) {
  const [isOpen, setIsOpen] = useState(defaultOpen);

  return (
    <Collapsible
      open={isOpen}
      onOpenChange={setIsOpen}
      className={cn("space-y-2", className)}
    >
      <CollapsibleTrigger asChild>
        <button
          type="button"
          className={cn(
            "flex w-full items-center justify-between rounded-lg border p-4",
            "min-h-[44px] touch-manipulation", // 44px touch target (FORM-03)
            "hover:bg-muted/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
            "transition-colors"
          )}
          aria-expanded={isOpen}
        >
          <div className="text-left">
            <h3 className="text-base font-medium">{title}</h3>
            {description && (
              <p className="text-sm text-muted-foreground">{description}</p>
            )}
          </div>
          <ChevronDown
            className={cn(
              "h-5 w-5 shrink-0 text-muted-foreground transition-transform duration-200",
              isOpen && "rotate-180"
            )}
            aria-hidden="true"
          />
        </button>
      </CollapsibleTrigger>
      <CollapsibleContent className="space-y-4 px-1 pt-2">
        {children}
      </CollapsibleContent>
    </Collapsible>
  );
}
```

Key features:
- 44px min-height on trigger (FORM-03)
- touch-manipulation for mobile
- Chevron rotation animation
- focus-visible for keyboard navigation
- aria-expanded for accessibility
  </action>
  <verify>TypeScript compilation passes</verify>
  <done>CollapsibleSection exports with 44px touch target and accessibility attributes</done>
</task>

<task type="auto">
  <name>Task 2: Create MobileFormField component</name>
  <files>frontend/components/forms/mobile-form-field.tsx</files>
  <action>
Create mobile-form-field.tsx following research Pattern 6:

```typescript
"use client";

import { useFormContext, type FieldPath, type FieldValues } from "react-hook-form";
import { AlertCircle } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { cn } from "@/lib/utils";

type InputMode = "text" | "numeric" | "decimal" | "email" | "tel" | "search" | "url" | "none";

interface MobileFormFieldProps<TFieldValues extends FieldValues = FieldValues> {
  /** Field name (must match form schema) */
  name: FieldPath<TFieldValues>;
  /** Visible label above input */
  label: string;
  /** Whether field is required */
  required?: boolean;
  /** Input type attribute */
  type?: "text" | "email" | "tel" | "password" | "url";
  /** Mobile keyboard type hint */
  inputMode?: InputMode;
  /** Placeholder text */
  placeholder?: string;
  /** Additional classes for container */
  className?: string;
  /** Disabled state */
  disabled?: boolean;
  /** Pattern for validation */
  pattern?: string;
  /** Autocomplete hint */
  autoComplete?: string;
  /** Min value for numeric inputs */
  min?: number;
  /** Max value for numeric inputs */
  max?: number;
}

export function MobileFormField<TFieldValues extends FieldValues = FieldValues>({
  name,
  label,
  required,
  type = "text",
  inputMode,
  placeholder,
  className,
  disabled,
  pattern,
  autoComplete,
  min,
  max,
}: MobileFormFieldProps<TFieldValues>) {
  const {
    register,
    formState: { errors },
  } = useFormContext<TFieldValues>();

  // Get nested error (supports dot notation like "address.city")
  const error = name.split(".").reduce<any>((obj, key) => obj?.[key], errors);
  const errorMessage = error?.message as string | undefined;
  const errorId = `${name}-error`;

  return (
    <div className={cn("space-y-2", className)}>
      {/* Always-visible label (FORM-04) */}
      <Label
        htmlFor={name}
        className="text-base font-medium" // 16px (FORM-08)
      >
        {label}
        {required && <span className="text-destructive ml-1" aria-hidden="true">*</span>}
        {required && <span className="sr-only">(required)</span>}
      </Label>

      {/* Input with mobile optimizations */}
      <Input
        id={name}
        type={type}
        inputMode={inputMode}
        placeholder={placeholder}
        disabled={disabled}
        pattern={pattern}
        autoComplete={autoComplete}
        min={min}
        max={max}
        className={cn(
          "text-base", // 16px to prevent iOS zoom (FORM-08)
          "min-h-[44px]", // 44px touch target (FORM-03)
        )}
        aria-invalid={errorMessage ? "true" : "false"}
        aria-describedby={errorMessage ? errorId : undefined}
        {...register(name, {
          valueAsNumber: inputMode === "numeric" || inputMode === "decimal" ? true : undefined,
        })}
      />

      {/* Inline validation error (FORM-05) */}
      {errorMessage && (
        <p
          id={errorId}
          className="flex items-center gap-1.5 text-sm text-destructive"
          role="alert"
        >
          <AlertCircle className="h-3.5 w-3.5 shrink-0" aria-hidden="true" />
          <span>{errorMessage}</span>
        </p>
      )}
    </div>
  );
}
```

Key features:
- text-base (16px) on label AND input (FORM-08)
- min-h-[44px] touch target (FORM-03)
- Label always visible above input (FORM-04)
- Inline error with icon (FORM-05)
- inputMode for mobile keyboards (FORM-02)
- aria-invalid and aria-describedby for accessibility
- Support for nested field names (dot notation)
- valueAsNumber for numeric inputs
  </action>
  <verify>TypeScript compilation passes with react-hook-form generics</verify>
  <done>MobileFormField exports with 16px fonts, 44px targets, visible labels, and inline errors</done>
</task>

<task type="auto">
  <name>Task 3: Create barrel export and textarea variant</name>
  <files>
    frontend/components/forms/mobile-form-textarea.tsx
    frontend/components/forms/index.ts
  </files>
  <action>
1. Create mobile-form-textarea.tsx for multi-line text fields:

```typescript
"use client";

import { useFormContext, type FieldPath, type FieldValues } from "react-hook-form";
import { AlertCircle } from "lucide-react";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { cn } from "@/lib/utils";

interface MobileFormTextareaProps<TFieldValues extends FieldValues = FieldValues> {
  /** Field name (must match form schema) */
  name: FieldPath<TFieldValues>;
  /** Visible label above input */
  label: string;
  /** Whether field is required */
  required?: boolean;
  /** Placeholder text */
  placeholder?: string;
  /** Additional classes for container */
  className?: string;
  /** Disabled state */
  disabled?: boolean;
  /** Number of visible rows */
  rows?: number;
}

export function MobileFormTextarea<TFieldValues extends FieldValues = FieldValues>({
  name,
  label,
  required,
  placeholder,
  className,
  disabled,
  rows = 3,
}: MobileFormTextareaProps<TFieldValues>) {
  const {
    register,
    formState: { errors },
  } = useFormContext<TFieldValues>();

  const error = name.split(".").reduce<any>((obj, key) => obj?.[key], errors);
  const errorMessage = error?.message as string | undefined;
  const errorId = `${name}-error`;

  return (
    <div className={cn("space-y-2", className)}>
      <Label
        htmlFor={name}
        className="text-base font-medium"
      >
        {label}
        {required && <span className="text-destructive ml-1" aria-hidden="true">*</span>}
        {required && <span className="sr-only">(required)</span>}
      </Label>

      <Textarea
        id={name}
        placeholder={placeholder}
        disabled={disabled}
        rows={rows}
        className={cn(
          "text-base", // 16px to prevent iOS zoom
          "min-h-[88px]", // At least 2x 44px for touch
        )}
        aria-invalid={errorMessage ? "true" : "false"}
        aria-describedby={errorMessage ? errorId : undefined}
        {...register(name)}
      />

      {errorMessage && (
        <p
          id={errorId}
          className="flex items-center gap-1.5 text-sm text-destructive"
          role="alert"
        >
          <AlertCircle className="h-3.5 w-3.5 shrink-0" aria-hidden="true" />
          <span>{errorMessage}</span>
        </p>
      )}
    </div>
  );
}
```

2. Create index.ts barrel export:

```typescript
export { CollapsibleSection } from "./collapsible-section";
export { MobileFormField } from "./mobile-form-field";
export { MobileFormTextarea } from "./mobile-form-textarea";
```
  </action>
  <verify>
    - `cd frontend && bun run build` succeeds
    - Import from "@/components/forms" works
  </verify>
  <done>
    - MobileFormTextarea component with 16px font and proper sizing
    - Barrel export at frontend/components/forms/index.ts
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && bun run build` completes without errors
2. `cd frontend && bun run lint` passes
3. All files exist:
   - frontend/components/forms/collapsible-section.tsx
   - frontend/components/forms/mobile-form-field.tsx
   - frontend/components/forms/mobile-form-textarea.tsx
   - frontend/components/forms/index.ts
4. Components use correct Tailwind classes:
   - min-h-[44px] for touch targets
   - text-base for 16px fonts
   - space-y-2 for label spacing
</verification>

<success_criteria>
- CollapsibleSection wraps content with animated expand/collapse
- MobileFormField provides 44px touch targets and 16px font
- Labels always visible above inputs (not placeholder-only)
- Validation errors display inline with icon
- All components properly typed with react-hook-form generics
- Barrel export available at @/components/forms
</success_criteria>

<output>
After completion, create `.planning/phases/21-mobile-form-improvements/21-02-SUMMARY.md`
</output>
