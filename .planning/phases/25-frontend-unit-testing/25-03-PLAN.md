---
phase: 25-frontend-unit-testing
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/components/forms/__tests__/multi-step-form.test.tsx
autonomous: true

must_haves:
  truths:
    - "MultiStepForm validates current step before advancing"
    - "MultiStepForm persists draft on value changes"
    - "MultiStepForm loads draft on mount"
    - "MultiStepForm clears draft on successful submit"
    - "MultiStepForm navigates back to previous steps"
  artifacts:
    - path: "frontend/components/forms/__tests__/multi-step-form.test.tsx"
      provides: "MultiStepForm component tests"
      min_lines: 150
  key_links:
    - from: "multi-step-form.test.tsx"
      to: "lib/hooks/use-form-draft"
      via: "vi.mock"
      pattern: "vi\\.mock.*use-form-draft"
    - from: "multi-step-form.test.tsx"
      to: "lib/hooks/use-ios-keyboard"
      via: "vi.mock"
      pattern: "vi\\.mock.*use-ios-keyboard"
---

<objective>
Add tests for MultiStepForm component covering multi-step navigation, validation, and state persistence.

Purpose: Prevent form flow regressions (FE-03 requirement)
Output: Test file with 12+ test cases covering form hooks and navigation
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-frontend-unit-testing/25-RESEARCH.md
@frontend/components/forms/multi-step-form.tsx
@frontend/lib/hooks/__tests__/use-global-search.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MultiStepForm test file with navigation and validation tests</name>
  <files>frontend/components/forms/__tests__/multi-step-form.test.tsx</files>
  <action>
Create test file for MultiStepForm component. Focus on form flow behavior, not react-hook-form internals.

**Mocking setup:**
- Mock `@/lib/hooks/use-form-draft` - returns { loadDraft, saveDraft, clearDraft } functions
- Mock `@/lib/hooks/use-ios-keyboard` - returns { isKeyboardOpen: false, getFixedBottomStyle: () => ({}) }
- Mock `uuid` v7 - return predictable draft IDs

**Test schema for forms:**
```typescript
import { z } from "zod";

const testSchema = z.object({
  name: z.string().min(1, "Name required"),
  email: z.string().email("Invalid email"),
});

const testSteps = [
  { id: "step1", label: "Name" },
  { id: "step2", label: "Email" },
];

const testStepFields = [["name"], ["email"]];
```

**Test suites to implement:**

1. **Initial state tests:**
   - "shows loading skeleton while loading draft"
   - "renders first step after draft loads"
   - "loads draft data into form on mount"
   - "initializes with default values when no draft"

2. **Navigation tests:**
   - "goNext advances to next step"
   - "goBack returns to previous step"
   - "goBack on first step calls onCancel"
   - "clicking step indicator navigates to previous steps only"

3. **Validation tests:**
   - "validates current step before advancing"
   - "does not advance when validation fails"
   - "shows validation errors on invalid step"

4. **Draft persistence tests:**
   - "saves draft when form values change"
   - "clears draft on successful submit"
   - "does not save draft before initial load completes"

5. **Submission tests:**
   - "calls onSubmit with form data on last step"
   - "shows isSubmitting state during submit"
   - "resets isSubmitting after submit completes"

6. **Keyboard handling tests:**
   - "passes keyboardStyle to children"
   - "passes isKeyboardOpen to children"

**Implementation notes:**
- Use `render` from @testing-library/react
- Use `userEvent.setup()` for realistic interactions
- Use `waitFor` to wait for async draft loading
- The component uses FormProvider, so render children that access form context
- Mock the children render prop to inspect passed props
  </action>
  <verify>
Run: `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && bun test multi-step-form --reporter=verbose`
All tests pass.
  </verify>
  <done>
MultiStepForm component has 12+ passing tests covering:
- Initial state (loading skeleton, draft loading, default values)
- Navigation (goNext, goBack, step indicator clicks)
- Validation (step validation, error display)
- Draft persistence (save on change, clear on submit)
- Submission (onSubmit callback, isSubmitting state)
  </done>
</task>

</tasks>

<verification>
```bash
cd /home/antti/Repos/Misc/home-warehouse-system/frontend
bun test multi-step-form --reporter=verbose
```

Expect:
- All tests pass
- Form navigation and validation behaviors verified
</verification>

<success_criteria>
- Test file exists at frontend/components/forms/__tests__/multi-step-form.test.tsx
- 12+ test cases covering documented behaviors
- All tests pass
- Tests verify form flow without testing react-hook-form internals
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-unit-testing/25-03-SUMMARY.md`
</output>
