---
phase: 25-frontend-unit-testing
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/components/fab/__tests__/floating-action-button.test.tsx
autonomous: true

must_haves:
  truths:
    - "FloatingActionButton toggles open/closed on click"
    - "FloatingActionButton closes on Escape key"
    - "FloatingActionButton closes on outside click"
    - "FloatingActionButton calls action onClick and closes menu"
    - "FloatingActionButton has correct ARIA attributes"
  artifacts:
    - path: "frontend/components/fab/__tests__/floating-action-button.test.tsx"
      provides: "FloatingActionButton component tests"
      min_lines: 100
  key_links:
    - from: "floating-action-button.test.tsx"
      to: "motion/react"
      via: "vi.mock"
      pattern: "vi\\.mock.*motion/react"
    - from: "floating-action-button.test.tsx"
      to: "lib/hooks/use-haptic"
      via: "vi.mock"
      pattern: "vi\\.mock.*use-haptic"
---

<objective>
Add tests for FloatingActionButton component verifying radial menu expansion, item selection, and gestures.

Purpose: Prevent FAB interaction regressions (FE-05 requirement)
Output: Test file with 10+ test cases covering FAB behaviors
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-frontend-unit-testing/25-RESEARCH.md
@frontend/components/fab/floating-action-button.tsx
@frontend/components/fab/fab-action-item.tsx
@frontend/lib/hooks/__tests__/use-global-search.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FloatingActionButton test file with animation mocks</name>
  <files>frontend/components/fab/__tests__/floating-action-button.test.tsx</files>
  <action>
Create test file for FloatingActionButton component. Mock motion library and haptic feedback.

**Mocking setup:**

1. **Mock motion/react to render static elements:**
```typescript
vi.mock("motion/react", () => ({
  motion: {
    div: ({ children, ...props }: React.PropsWithChildren<Record<string, unknown>>) => (
      <div {...props}>{children}</div>
    ),
  },
}));
```

2. **Mock haptic feedback:**
```typescript
vi.mock("@/lib/hooks/use-haptic", () => ({
  triggerHaptic: vi.fn(),
}));
```

**Test actions setup:**
```typescript
const mockActions = [
  {
    id: "add",
    icon: <span data-testid="icon-add">+</span>,
    label: "Add Item",
    onClick: vi.fn(),
  },
  {
    id: "scan",
    icon: <span data-testid="icon-scan">S</span>,
    label: "Scan",
    onClick: vi.fn(),
  },
];
```

**Test suites to implement:**

1. **Toggle behavior tests:**
   - "renders main FAB button"
   - "toggles menu open on click"
   - "toggles menu closed on second click"
   - "triggers haptic feedback on toggle"

2. **Keyboard interaction tests:**
   - "closes menu on Escape key"
   - "does nothing on Escape when already closed"

3. **Outside click tests:**
   - "closes menu on outside click"
   - "does not close on click inside container"

4. **Action item tests:**
   - "renders action items when menu is open"
   - "hides action items when menu is closed"
   - "calls action onClick when action button clicked"
   - "closes menu after action is triggered"
   - "triggers haptic feedback on action click"

5. **Accessibility tests:**
   - "main button has aria-expanded=false when closed"
   - "main button has aria-expanded=true when open"
   - "main button has correct aria-label based on state"
   - "main button has aria-haspopup=menu"
   - "action items have role=menuitem"
   - "action items have aria-label matching action label"

6. **Radial positioning tests:**
   - "positions actions in radial layout"
   - "respects custom radius prop"
   - "respects custom startAngle and arcAngle props"

**Implementation notes:**
- Use userEvent.setup() for realistic interactions
- Test ARIA attributes for accessibility compliance
- Motion library mock should pass through props to div for testing
- Reset mock functions in beforeEach
- Use vi.advanceTimersByTime for click-outside timeout if needed
  </action>
  <verify>
Run: `cd /home/antti/Repos/Misc/home-warehouse-system/frontend && bun test floating-action-button --reporter=verbose`
All tests pass.
  </verify>
  <done>
FloatingActionButton component has 10+ passing tests covering:
- Toggle behavior (open/close on click, haptic feedback)
- Keyboard interactions (Escape key closes)
- Outside click handling
- Action item rendering and callbacks
- Accessibility (ARIA attributes)
  </done>
</task>

</tasks>

<verification>
```bash
cd /home/antti/Repos/Misc/home-warehouse-system/frontend
bun test floating-action-button --reporter=verbose
```

Expect:
- All tests pass
- FAB interactions and accessibility verified
</verification>

<success_criteria>
- Test file exists at frontend/components/fab/__tests__/floating-action-button.test.tsx
- 10+ test cases covering documented behaviors
- All tests pass
- Animation library mocking works correctly
- Accessibility attributes tested
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-unit-testing/25-05-SUMMARY.md`
</output>
