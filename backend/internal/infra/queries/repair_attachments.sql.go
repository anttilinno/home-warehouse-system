// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: repair_attachments.sql

package queries

import (
	"context"
	"time"

	"github.com/google/uuid"
)

const deleteRepairAttachment = `-- name: DeleteRepairAttachment :exec
DELETE FROM warehouse.repair_attachments
WHERE id = $1 AND workspace_id = $2
`

type DeleteRepairAttachmentParams struct {
	ID          uuid.UUID `json:"id"`
	WorkspaceID uuid.UUID `json:"workspace_id"`
}

func (q *Queries) DeleteRepairAttachment(ctx context.Context, arg DeleteRepairAttachmentParams) error {
	_, err := q.db.Exec(ctx, deleteRepairAttachment, arg.ID, arg.WorkspaceID)
	return err
}

const getRepairAttachment = `-- name: GetRepairAttachment :one
SELECT id, repair_log_id, workspace_id, file_id, attachment_type, title, created_at, updated_at FROM warehouse.repair_attachments
WHERE id = $1 AND workspace_id = $2
`

type GetRepairAttachmentParams struct {
	ID          uuid.UUID `json:"id"`
	WorkspaceID uuid.UUID `json:"workspace_id"`
}

func (q *Queries) GetRepairAttachment(ctx context.Context, arg GetRepairAttachmentParams) (WarehouseRepairAttachment, error) {
	row := q.db.QueryRow(ctx, getRepairAttachment, arg.ID, arg.WorkspaceID)
	var i WarehouseRepairAttachment
	err := row.Scan(
		&i.ID,
		&i.RepairLogID,
		&i.WorkspaceID,
		&i.FileID,
		&i.AttachmentType,
		&i.Title,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const insertRepairAttachment = `-- name: InsertRepairAttachment :one
INSERT INTO warehouse.repair_attachments (
    id, repair_log_id, workspace_id, file_id, attachment_type, title
)
VALUES ($1, $2, $3, $4, $5, $6)
RETURNING id, repair_log_id, workspace_id, file_id, attachment_type, title, created_at, updated_at
`

type InsertRepairAttachmentParams struct {
	ID             uuid.UUID                   `json:"id"`
	RepairLogID    uuid.UUID                   `json:"repair_log_id"`
	WorkspaceID    uuid.UUID                   `json:"workspace_id"`
	FileID         uuid.UUID                   `json:"file_id"`
	AttachmentType WarehouseAttachmentTypeEnum `json:"attachment_type"`
	Title          *string                     `json:"title"`
}

func (q *Queries) InsertRepairAttachment(ctx context.Context, arg InsertRepairAttachmentParams) (WarehouseRepairAttachment, error) {
	row := q.db.QueryRow(ctx, insertRepairAttachment,
		arg.ID,
		arg.RepairLogID,
		arg.WorkspaceID,
		arg.FileID,
		arg.AttachmentType,
		arg.Title,
	)
	var i WarehouseRepairAttachment
	err := row.Scan(
		&i.ID,
		&i.RepairLogID,
		&i.WorkspaceID,
		&i.FileID,
		&i.AttachmentType,
		&i.Title,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listRepairAttachmentsByRepairLog = `-- name: ListRepairAttachmentsByRepairLog :many
SELECT
    ra.id,
    ra.repair_log_id,
    ra.workspace_id,
    ra.file_id,
    ra.attachment_type,
    ra.title,
    ra.created_at,
    ra.updated_at,
    f.original_name AS file_name,
    f.mime_type AS file_mime_type,
    f.size_bytes AS file_size,
    f.storage_key AS file_storage_key
FROM warehouse.repair_attachments ra
JOIN warehouse.files f ON ra.file_id = f.id
WHERE ra.repair_log_id = $1 AND ra.workspace_id = $2
ORDER BY ra.created_at ASC
`

type ListRepairAttachmentsByRepairLogParams struct {
	RepairLogID uuid.UUID `json:"repair_log_id"`
	WorkspaceID uuid.UUID `json:"workspace_id"`
}

type ListRepairAttachmentsByRepairLogRow struct {
	ID             uuid.UUID                   `json:"id"`
	RepairLogID    uuid.UUID                   `json:"repair_log_id"`
	WorkspaceID    uuid.UUID                   `json:"workspace_id"`
	FileID         uuid.UUID                   `json:"file_id"`
	AttachmentType WarehouseAttachmentTypeEnum `json:"attachment_type"`
	Title          *string                     `json:"title"`
	CreatedAt      time.Time                   `json:"created_at"`
	UpdatedAt      time.Time                   `json:"updated_at"`
	FileName       string                      `json:"file_name"`
	FileMimeType   *string                     `json:"file_mime_type"`
	FileSize       *int64                      `json:"file_size"`
	FileStorageKey *string                     `json:"file_storage_key"`
}

func (q *Queries) ListRepairAttachmentsByRepairLog(ctx context.Context, arg ListRepairAttachmentsByRepairLogParams) ([]ListRepairAttachmentsByRepairLogRow, error) {
	rows, err := q.db.Query(ctx, listRepairAttachmentsByRepairLog, arg.RepairLogID, arg.WorkspaceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListRepairAttachmentsByRepairLogRow{}
	for rows.Next() {
		var i ListRepairAttachmentsByRepairLogRow
		if err := rows.Scan(
			&i.ID,
			&i.RepairLogID,
			&i.WorkspaceID,
			&i.FileID,
			&i.AttachmentType,
			&i.Title,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.FileName,
			&i.FileMimeType,
			&i.FileSize,
			&i.FileStorageKey,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
